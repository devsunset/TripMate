# TravelMate Backend API 테스트 결과 (전체 API 케이스 정리)
# 기준 URL: http://localhost:3000 (개발) / 환경에 따라 변경
# 테스트 일시: 2026-02 기준 갱신
# 인증 필요 라우트: Authorization: Bearer <Firebase ID 토큰>

================================================================================
1. 서버 상태
================================================================================
GET /
  요청: curl -s http://localhost:3000/
  응답: HTTP 200
  본문: TravelMate Backend API is running!
  테스트 결과: 통과

================================================================================
2. 인증 API (/api/auth)
================================================================================
2.1 GET /api/auth/me
  인증: 필수 (Bearer 토큰)
  요청(토큰 없음): curl -s http://localhost:3000/api/auth/me
  응답: HTTP 401 | Unauthorized: 토큰이 제공되지 않았습니다.
  테스트 결과: 통과

  요청(유효 토큰): curl -s -H "Authorization: Bearer <TOKEN>" http://localhost:3000/api/auth/me
  응답: HTTP 200 | {"userId":"<백엔드_사용자_id>"}

2.2 POST /api/auth/register
  Body: { "idToken": "<Firebase ID Token>" }
  요청(body 없음): curl -s -X POST -H "Content-Type: application/json" -d '{}' http://localhost:3000/api/auth/register
  응답: HTTP 400 | {"message":"Firebase ID 토큰이 필요합니다."}
  테스트 결과: 통과

  요청(잘못된 idToken): curl -s -X POST -H "Content-Type: application/json" -d '{"idToken":"invalid"}' ...
  응답: HTTP 401 | {"message":"유효하지 않거나 만료된 ID 토큰입니다."}
  테스트 결과: 통과

  요청(유효 idToken): 사용자 생성 또는 기존 사용자 반환. HTTP 200 + userId 등.

2.3 POST /api/auth/login
  Body: { "idToken": "<Firebase ID Token>" }
  요청(body 없음): HTTP 400 | {"message":"Firebase ID 토큰이 필요합니다."}
  테스트 결과: 통과

================================================================================
3. 보호 라우트 테스트
================================================================================
GET /api/protected
  인증: 필수
  요청(토큰 없음): HTTP 401 | Unauthorized: 토큰이 제공되지 않았습니다.
  테스트 결과: 통과
  요청(유효 토큰): HTTP 200 | {"message":"보호된 라우트 접근 성공","user":{...}}

================================================================================
4. 사용자·프로필 API (/api/users)
================================================================================
4.1 GET /api/users/search
  인증: 필수
  Query: destination?, keyword?, gender?, ageRange?, travelStyles?, interests?, limit?, offset?
  요청(토큰 없음): HTTP 401
  테스트 결과: 통과
  응답(유효 토큰): HTTP 200 | {"users":[...], "total", "limit", "offset"}

4.2 GET /api/users/:userId/profile
  인증: 필수 (Bearer)
  응답: HTTP 200 | userProfile (id, userId, nickname, bio, profileImageUrl, gender, ageRange, travelStyles, interests, preferredDestinations 등)

4.3 PATCH /api/users/:userId/profile
  인증: 필수. 본인만 수정 가능.
  Body: nickname?, bio?, profileImageUrl?, gender?, ageRange?, travelStyles?, interests?, preferredDestinations?
  응답: HTTP 200 | {"message":"프로필이 수정되었습니다.","userProfile":{...}}

4.4 POST /api/users/:userId/profile/image
  인증: 필수. Body에 profileImageUrl 등 전달 (이미지 URL 업데이트).
  응답: HTTP 200

4.5 DELETE /api/users/:userId
  인증: 필수. 본인만 탈퇴 가능. Firebase Auth 및 MariaDB 사용자·관련 데이터 삭제.
  응답: HTTP 200 또는 204

================================================================================
5. 게시글 API (/api/posts)
================================================================================
5.1 GET /api/posts
  인증: 필수
  Query: category?, search?, limit?, offset?
  요청(토큰 없음): HTTP 401
  테스트 결과: 통과
  응답(유효 토큰): HTTP 200 | {"total", "limit", "offset", "posts":[...]} (post에 Author.UserProfile.nickname 포함)

5.2 GET /api/posts/:postId
  인증: 필수
  응답: HTTP 200 | {"post":{...}} (Author, Category, Author.UserProfile.nickname 포함). 없으면 404.

5.3 POST /api/posts
  인증: 필수
  Body: title, content, category, imageUrls? (카테고리는 post_categories.name 기준)
  응답: HTTP 201 | {"message":"게시글이 작성되었습니다.","post":{...}}

5.4 PATCH /api/posts/:postId
  인증: 필수. 작성자만 수정 가능.
  Body: title?, content?, category?, imageUrls?
  응답: HTTP 200 | {"message":"게시글이 수정되었습니다.","post":{...}}

5.5 DELETE /api/posts/:postId
  인증: 필수. 작성자만 삭제 가능.
  응답: HTTP 204

================================================================================
6. 댓글 API (/api/comments)
================================================================================
6.1 GET /api/comments
  인증: 필수
  Query: postId 또는 itineraryId (필수 하나)
  요청(토큰 없음): HTTP 401
  테스트 결과: 통과
  요청(postId=1, 유효 토큰): HTTP 200 | {"comments":[...]} (각 댓글에 Author.id, Author.UserProfile.nickname 포함, Replies 중첩)

6.2 POST /api/comments
  인증: 필수
  Body: content (필수), postId?, itineraryId?, parentCommentId?
  응답: HTTP 201 | {"message":"댓글이 등록되었습니다.","comment":{...}} (comment에 Author+UserProfile 포함)

6.3 PATCH /api/comments/:commentId
  인증: 필수. 작성자만 수정 가능.
  Body: content
  응답: HTTP 200 | {"message":"댓글이 수정되었습니다.","comment":{...}}

6.4 DELETE /api/comments/:commentId
  인증: 필수. 작성자만 삭제 가능.
  요청(토큰 없음): HTTP 401
  테스트 결과: 통과
  응답: HTTP 204

================================================================================
7. 채팅 API (/api/chat)
================================================================================
7.1 GET /api/chat/rooms
  인증: 필수
  응답: HTTP 200 | {"chatRooms":[...]} (partnerNickname, partnerProfileImageUrl, lastMessage 등)

7.2 POST /api/chat/room
  인증: 필수
  Body: { "partnerId": "<상대방 백엔드 userId>" }
  응답: 기존 방 있으면 200 + 해당 방, 없으면 생성 후 201. 상대 없으면 404.

================================================================================
8. 일정 API (/api/itineraries)
================================================================================
8.1 GET /api/itineraries
  인증: 필수
  Query: search?, limit?, offset?
  응답: HTTP 200 | {"total", "limit", "offset", "itineraries":[...]} (Author.UserProfile.nickname 포함)

8.2 GET /api/itineraries/:itineraryId
  인증: 필수
  응답: HTTP 200 | {"itinerary":{..., "Days":[...]}} (Author, Author.UserProfile.nickname 포함). 없으면 404.

8.3 POST /api/itineraries
  인증: 필수
  Body: title, description, startDate, endDate, imageUrls?, mapData?, days? (일차·활동 중첩)
  응답: HTTP 201 | {"message":"일정이 생성되었습니다.","itinerary":{...}}

8.4 PATCH /api/itineraries/:itineraryId
  인증: 필수. 작성자만 수정 가능.
  Body: title?, description?, startDate?, endDate?, imageUrls?, mapData?, days?
  응답: HTTP 200

8.5 DELETE /api/itineraries/:itineraryId
  인증: 필수. 작성자만 삭제 가능.
  응답: HTTP 204

================================================================================
9. 좋아요·북마크 API (/api/interactions)
================================================================================
9.1 POST /api/interactions/toggleLike
  인증: 필수
  Body: { "contentId": <number>, "contentType": "post" | "itinerary" }
  응답: HTTP 200 | {"message":"좋아요를 눌렀습니다.|좋아요를 취소했습니다.","isLiked": true|false, "likeCountChange": 1|-1}
  비고: DB 스키마가 doc/travel_mate.sql 기준으로 likes 테이블에 대리 키 id + (userId, postId)/(userId, itineraryId) 유니크 적용됨. 게시글만/일정만 좋아요 시 정상 동작.

9.2 POST /api/interactions/toggleBookmark
  인증: 필수
  Body: { "contentId": <number>, "contentType": "post" | "itinerary" }
  응답: HTTP 200 | {"message":"Bookmarked successfully|Unbookmarked successfully","isBookmarked": true|false}

================================================================================
10. 쪽지 API (/api/messages)
================================================================================
10.1 POST /api/messages/private
  인증: 필수
  Body: { "receiverId": "<userId>", "content": "<텍스트>" }
  응답: HTTP 201 등. 수신자에게 FCM 푸시 발송.

================================================================================
11. FCM API (/api/fcm)
================================================================================
11.1 POST /api/fcm/token
  인증: 필수
  Body: { "token": "<FCM 디바이스 토큰>", "deviceType"?: "web"|"android"|"ios" }
  응답: HTTP 200 | {"message":"FCM 토큰이 등록되었습니다.","fcmToken":{...}}

11.2 DELETE /api/fcm/token
  인증: 필수
  Body: { "token": "<FCM 디바이스 토큰>" }
  응답: HTTP 204

================================================================================
12. 신고 API (/api/reports)
================================================================================
12.1 POST /api/reports/submit
  인증: 필수
  Body: entityType (post|itinerary|comment|user), entityId (문자열), reportType, reason?
  응답: HTTP 201 | {"message":"신고가 접수되었습니다.","report":{...}}

================================================================================
13. 업로드 API (/api/upload)
================================================================================
13.1 POST /api/upload/profile
  인증: 필수. multipart/form-data, 필드명: image.
  응답: HTTP 200 | { "imageUrl": "<uploads/... URL>" }. 토큰 없으면 401.

13.2 POST /api/upload/post
  인증: 필수. multipart/form-data, 필드명: image.
  응답: HTTP 200 | { "imageUrl": "..." }

13.3 POST /api/upload/itinerary
  인증: 필수. multipart/form-data, 필드명: image.
  응답: HTTP 200 | { "imageUrl": "..." }

================================================================================
14. 토큰 얻는 방법
================================================================================
앱 실행 → Google 로그인 → 설정 → 계정 설정 → "API 테스트용 토큰 복사" (해당 버튼이 있으면) → curl 시 -H "Authorization: Bearer <붙여넣기>"
또는 Firebase Auth에서 idToken 획득 후 동일하게 Bearer 헤더에 넣어 사용.

================================================================================
15. 라우트 요약 (현행)
================================================================================
/api/auth       : POST /register, POST /login, GET /me
/api/users      : GET /search, GET /:userId/profile, PATCH /:userId/profile, POST /:userId/profile/image, DELETE /:userId
/api/posts      : GET /, GET /:postId, POST /, PATCH /:postId, DELETE /:postId
/api/itineraries: GET /, GET /:itineraryId, POST /, PATCH /:itineraryId, DELETE /:itineraryId
/api/comments   : GET /, POST /, PATCH /:commentId, DELETE /:commentId
/api/chat       : GET /rooms, POST /room
/api/interactions: POST /toggleLike, POST /toggleBookmark
/api/messages   : POST /private
/api/fcm        : POST /token, DELETE /token
/api/reports    : POST /submit
/api/upload     : POST /profile, POST /post, POST /itinerary
