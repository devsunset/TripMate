# TravelMate Backend API curl 테스트 결과 (전체 갱신)
# 기준 URL: http://localhost:3000
# 테스트 일시: 유효한 Firebase ID 토큰으로 전체 API case별 요청/응답 실행
# 인증 필요 라우트: Authorization: Bearer <Firebase ID 토큰>

================================================================================
1. 서버 상태
================================================================================
요청: GET /
curl -s http://localhost:3000/
응답: HTTP 200
TravelMate Backend API is running!

================================================================================
2. 인증 API
================================================================================

2.1 GET /api/auth/me (유효 토큰)
요청: curl -s -H "Authorization: Bearer <TOKEN>" http://localhost:3000/api/auth/me
응답: HTTP 200
{"userId":"fl2TfXCimJoGsDaB"}

2.2 GET /api/auth/me (토큰 없음)
요청: curl -s http://localhost:3000/api/auth/me
응답: HTTP 401
Unauthorized: 토큰이 제공되지 않았습니다.

2.3 POST /api/auth/register (body 없음)
요청: curl -s -X POST -H "Content-Type: application/json" -d '{}' http://localhost:3000/api/auth/register
응답: HTTP 400
{"message":"Firebase ID 토큰이 필요합니다."}

2.4 POST /api/auth/register (잘못된 idToken)
요청: curl -s -X POST -H "Content-Type: application/json" -d '{"idToken":"invalid"}' http://localhost:3000/api/auth/register
응답: HTTP 401
{"message":"유효하지 않거나 만료된 ID 토큰입니다."}

2.5 POST /api/auth/login (body 없음)
요청: curl -s -X POST -H "Content-Type: application/json" -d '{}' http://localhost:3000/api/auth/login
응답: HTTP 400
{"message":"Firebase ID 토큰이 필요합니다."}

================================================================================
3. 보호 라우트 테스트
================================================================================
요청: GET /api/protected (유효 토큰)
curl -s -H "Authorization: Bearer <TOKEN>" http://localhost:3000/api/protected
응답: HTTP 200
{"message":"보호된 라우트 접근 성공","user":{...}}

================================================================================
4. 사용자·프로필 API
================================================================================

4.1 GET /api/users/search?limit=2
요청: curl -s -H "Authorization: Bearer <TOKEN>" "http://localhost:3000/api/users/search?limit=2"
응답: HTTP 200
{"total":0,"limit":2,"offset":0,"users":[]}

4.2 GET /api/users/:userId/profile
요청: curl -s -H "Authorization: Bearer <TOKEN>" http://localhost:3000/api/users/fl2TfXCimJoGsDaB/profile
응답: HTTP 200
{"userProfile":{"id":1,"userId":"fl2TfXCimJoGsDaB","nickname":"ok","bio":"test",...}}

4.3 PATCH /api/users/:userId/profile
요청: curl -s -X PATCH -H "Authorization: Bearer <TOKEN>" -H "Content-Type: application/json" -d '{"bio":"test bio"}' http://localhost:3000/api/users/fl2TfXCimJoGsDaB/profile
응답: HTTP 200
{"message":"프로필이 수정되었습니다.","userProfile":{...}}

================================================================================
5. 게시글 API
================================================================================

5.1 GET /api/posts?limit=2
요청: curl -s -H "Authorization: Bearer <TOKEN>" "http://localhost:3000/api/posts?limit=2"
응답: HTTP 200
{"total":1,"limit":2,"offset":0,"posts":[...]}

5.2 GET /api/posts/1
요청: curl -s -H "Authorization: Bearer <TOKEN>" http://localhost:3000/api/posts/1
응답: HTTP 200
{"post":{"id":1,"authorId":"fl2TfXCimJoGsDaB","title":"Test Post",...,"Category":{"name":"자유 게시판"}}}

5.3 POST /api/posts (생성)
요청: curl -s -X POST -H "Authorization: Bearer <TOKEN>" -H "Content-Type: application/json" -d '{"title":"Test Post","content":"Hello world","category":"자유 게시판"}' http://localhost:3000/api/posts
응답: HTTP 201
{"message":"게시글이 작성되었습니다.","post":{"id":1,"authorId":"fl2TfXCimJoGsDaB",...}}

5.4 PATCH /api/posts/1
요청: curl -s -X PATCH -H "Authorization: Bearer <TOKEN>" -H "Content-Type: application/json" -d '{"title":"Test Post Updated","content":"Hello"}' http://localhost:3000/api/posts/1
응답: HTTP 200
{"message":"게시글이 수정되었습니다.","post":{...}}

================================================================================
6. 댓글 API
================================================================================

6.1 GET /api/comments?postId=1
요청: curl -s -H "Authorization: Bearer <TOKEN>" "http://localhost:3000/api/comments?postId=1"
응답: HTTP 200
{"comments":[]}

6.2 POST /api/comments
요청: curl -s -X POST -H "Authorization: Bearer <TOKEN>" -H "Content-Type: application/json" -d '{"postId":1,"content":"Nice post!"}' http://localhost:3000/api/comments
참고: 게시글/일정 조회 시 Author include 추가 및 parentComment.Author 안전 접근 적용. 서버 재시작 후 HTTP 201 예상. (이전 500: parentContent.Author 미포함)

================================================================================
7. 채팅 API
================================================================================

7.1 GET /api/chat/rooms
요청: curl -s -H "Authorization: Bearer <TOKEN>" http://localhost:3000/api/chat/rooms
응답: HTTP 200
{"chatRooms":[]}

7.2 POST /api/chat/room (존재하지 않는 상대)
요청: curl -s -X POST -H "Authorization: Bearer <TOKEN>" -H "Content-Type: application/json" -d '{"partnerId":"nonexistent_user_999"}' http://localhost:3000/api/chat/room
응답: HTTP 404
{"message":"사용자 또는 상대를 찾을 수 없습니다."}

================================================================================
8. 일정 API
================================================================================

8.1 GET /api/itineraries?limit=2
요청: curl -s -H "Authorization: Bearer <TOKEN>" "http://localhost:3000/api/itineraries?limit=2"
응답: HTTP 200
{"total":1,"limit":2,"offset":0,"itineraries":[...]}

8.2 GET /api/itineraries/1
요청: curl -s -H "Authorization: Bearer <TOKEN>" http://localhost:3000/api/itineraries/1
응답: HTTP 200
{"itinerary":{"id":1,"authorId":"fl2TfXCimJoGsDaB","title":"Trip",...,"Days":[]}}

8.3 POST /api/itineraries (생성)
요청: curl -s -X POST -H "Authorization: Bearer <TOKEN>" -H "Content-Type: application/json" -d '{"title":"Trip","description":"Test","startDate":"2026-03-01","endDate":"2026-03-05"}' http://localhost:3000/api/itineraries
응답: HTTP 201
{"message":"일정이 생성되었습니다.","itinerary":{"id":1,...}}

================================================================================
9. 좋아요·북마크 API
================================================================================

9.1 POST /api/interactions/toggleLike
요청: curl -s -X POST -H "Authorization: Bearer <TOKEN>" -H "Content-Type: application/json" -d '{"contentId":1,"contentType":"post"}' http://localhost:3000/api/interactions/toggleLike
참고: 현재 DB의 likes 테이블이 (userId, postId, itineraryId) 복합 PK라서 PK 컬럼에 null 불가. 게시글만 좋아요 시 itineraryId=null 삽입이 거부되어 HTTP 500 발생. 스키마 변경(대리 키 + 유니크 제약) 필요.

9.2 POST /api/interactions/toggleBookmark
동일 이슈로 HTTP 500. bookmarks 테이블도 동일.

================================================================================
10. FCM API
================================================================================

10.1 POST /api/fcm/token
요청: curl -s -X POST -H "Authorization: Bearer <TOKEN>" -H "Content-Type: application/json" -d '{"token":"test_fcm_token_123","deviceType":"web"}' http://localhost:3000/api/fcm/token
응답: HTTP 200
{"message":"FCM 토큰이 등록되었습니다.","fcmToken":{...}}

10.2 DELETE /api/fcm/token
요청: curl -s -X DELETE -H "Authorization: Bearer <TOKEN>" -H "Content-Type: application/json" -d '{"token":"test_fcm_token_123"}' http://localhost:3000/api/fcm/token
응답: HTTP 204 (body 없음)

================================================================================
11. 신고 API
================================================================================

11.1 POST /api/reports/submit
요청: curl -s -X POST -H "Authorization: Bearer <TOKEN>" -H "Content-Type: application/json" -d '{"entityType":"post","entityId":"1","reportType":"spam","reason":"test"}' http://localhost:3000/api/reports/submit
응답: HTTP 201
{"message":"신고가 접수되었습니다.","report":{...}}

================================================================================
12. 업로드 API (인증 필요, multipart)
================================================================================
POST /api/upload/profile, /api/upload/post, /api/upload/itinerary
multipart 필드: image. 토큰 없으면 HTTP 401.

================================================================================
13. 테스트 시 적용한 소스 수정
================================================================================
- commentController.js: addComment 시 Post/Itinerary 조회에 Author include 추가. parentContent.Author 및 parentComment.Author 안전 접근(optional chaining) 적용. 서버 재시작 후 POST /api/comments 정상 동작 예상.
- likes/bookmarks 500: DB 스키마에서 복합 PK (userId, postId, itineraryId) 때문에 post만/일정만 좋아요 시 null 삽입 불가. doc/migration_likes_bookmarks_pk.sql 실행 후 200 정상 응답 가능.

================================================================================
14. 토큰 얻는 방법
================================================================================
앱 실행 → Google 로그인 → 설정 → 계정 설정 → "API 테스트용 토큰 복사" → curl 시 -H "Authorization: Bearer <붙여넣기>"
