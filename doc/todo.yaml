# 현행 구현: DB 초기 스키마는 doc/travel_mate.sql 단일 파일로 관리됨. 프로젝트 문서는 doc/ 폴더(trd.md, prd.md, test.txt, firebase.txt 등).
project:
  name: 트래블 메이트
  description: Flutter 기반의 모바일 커뮤니티 애플리케이션으로, 사용자가 여행 동반자를 찾고, 여행 정보를 공유하며, 채팅 요청 후 신청한/신청받은 채팅방 목록에서 선택해 1:1 실시간 채팅으로 소통할 수 있도록 지원합니다. 사용자 식별자는 랜덤 영숫자 ID(users PK=id)이며 이메일은 수집·저장하지 않습니다. 로그인은 Google만 지원. 백엔드는 Firebase와 Node.js API 서버, MariaDB를 활용하며, 이미지는 백엔드 저장(Firebase Storage 미사용).
tasks:
  - id: setup-001-environment
    title: 개발 환경 및 프로젝트 초기 설정
    priority: P0
    description: Flutter 모바일 앱, Node.js API 서버, MariaDB 데이터베이스, Firebase 프로젝트를 위한 개발 환경을 설정하고 초기 프로젝트 구조를 생성합니다. MariaDB 스키마
      마이그레이션 도구를 설정합니다.
    files:
      - path: travel_mate_app/
        description: Flutter 프로젝트 초기화 및 기본 폴더 구조 생성
        type: create
      - path: travel_mate_backend/
        description: Node.js/Express 프로젝트 초기화 및 기본 폴더 구조 생성
        type: create
      - path: doc/
        description: 프로젝트 문서 및 DB 스키마 (travel_mate.sql, trd, prd, test 등)
        type: create
      - path: package.json
        description: Node.js 프로젝트 의존성 관리 파일
        type: create
      - path: pubspec.yaml
        description: Flutter 프로젝트 의존성 관리 파일
        type: create
      - path: travel_mate_backend/.env.example
        description: 환경 변수 설정 예시 파일
        type: create
    subtasks:
      - id: setup-001-flutter-init
        title: Flutter 프로젝트 초기화
        description: Flutter 애플리케이션의 기본 구조를 설정하고, `pubspec.yaml`에 필수 패키지(provider/riverpod, dio, firebase_auth, cloud_firestore,
          image_picker, shared_preferences)를 추가합니다.
        category: setup
        implementation_notes:
          - Flutter 최신 버전으로 프로젝트를 생성합니다.
          - pubspec.yaml에 명시된 모든 Flutter 패키지를 추가하고 `flutter pub get`을 실행합니다.
          - Clean Architecture의 `data`, `domain`, `presentation` 레이어 폴더 구조를 생성합니다.
      - id: setup-001-nodejs-init
        title: Node.js API 서버 프로젝트 초기화
        description: Node.js 프로젝트를 초기화하고, `package.json`에 필수 패키지(express, sequelize/typeorm, firebase-admin, dotenv)를 추가합니다.
          `src` 폴더 내에 `app.js`, `config`, `controllers`, `middlewares`, `models`, `routes`, `services`, `utils` 디렉토리를
          생성합니다.
        category: setup
        implementation_notes:
          - Node.js LTS 버전을 사용하도록 설정합니다.
          - package.json에 명시된 모든 Node.js 패키지를 추가하고 `npm install`을 실행합니다.
          - 폴더 구조를 TRD에 명시된 대로 생성합니다.
      - id: setup-001-mariadb-init
        title: MariaDB 스키마 마이그레이션 도구 설정
        description: MariaDB 데이터베이스 스키마 관리를 위해 Flyway 또는 Knex.js 마이그레이션 도구를 설치하고 초기 설정을 완료합니다.
        category: setup
        implementation_notes:
          - Flyway 또는 Knex.js 중 하나를 선택하여 설정합니다. 여기서는 Knex.js를 가정합니다.
          - Knex.js 설정 파일(knexfile.js)을 생성하고 MariaDB 연결 정보를 설정합니다.
          - 초기 마이그레이션 스크립트 파일을 생성하여 마이그레이션 시스템을 테스트합니다.
      - id: setup-001-firebase-init
        title: Firebase 프로젝트 설정 및 연동
        description: Firebase 프로젝트를 생성하고, Flutter 앱과 Node.js API 서버에 Firebase SDK를 연동합니다. Firebase 인증, Firestore, Storage 서비스를
          활성화합니다.
        category: setup
        implementation_notes:
          - Firebase 콘솔에서 프로젝트를 생성하고 Flutter 앱(iOS, Android)을 등록합니다.
          - Flutter 프로젝트에 `firebase_core`를 추가하고 `flutterfire configure`를 실행하여 Firebase 설정을 완료합니다.
          - Node.js API 서버를 위해 Firebase Admin SDK 서비스 계정 키를 다운로드하고 `.env` 파일에 경로를 설정합니다.
      - id: setup-001-env-vars
        title: 환경 변수 설정
        description: "API 서버와 Flutter 앱에 필요한 환경 변수(예: Firebase API Key, DB 연결 정보 등)를 `.env` 파일을 통해 관리할 수 있도록 설정합니다."
        category: setup
        implementation_notes:
          - travel_mate_backend/.env 파일에 MariaDB 접속 정보와 Firebase Admin SDK key 경로를 설정합니다.
          - Flutter 앱의 경우, `flutter_dotenv` 또는 유사한 패키지를 사용하여 환경 변수를 관리합니다.
    completion_criteria:
      - Flutter 앱이 성공적으로 빌드되고 에뮬레이터에서 실행됩니다.
      - Node.js API 서버가 'npm start' 또는 'node src/app.js'로 성공적으로 시작됩니다.
      - MariaDB 마이그레이션 도구가 성공적으로 초기화되고 첫 마이그레이션 스크립트가 실행됩니다.
      - Firebase 콘솔에서 Auth, Firestore 서비스가 활성화됩니다.
      - Firebase SDK가 Flutter 앱과 Node.js 서버에서 정상적으로 초기화됩니다.
    risks:
      - risk: 환경 설정 오류로 인한 개발 지연
        mitigation: "명확한 환경 설정 가이드 제공 및 자동화 스크립트(예: Docker Compose) 고려"
      - risk: Firebase SDK 버전 충돌 또는 연동 문제
        mitigation: 최신 안정 버전 SDK 사용 및 공식 문서에 따라 단계별로 연동 진행
    order: 10
  - id: db-002-base-schema
    title: MariaDB 기본 데이터베이스 스키마 구축
    priority: P0
    description: MariaDB에 사용자 인증 및 프로필 관리에 필요한 `users`, `user_profiles`, `tags`, `user_profile_tags` 테이블을 포함하여 TRD에 정의된 모든
      기본 데이터 모델 스키마를 생성합니다. 현행 구현은 doc/travel_mate.sql 단일 파일에 전체 스키마(users, user_profiles, posts, comments, likes, bookmarks 등)가 정의되어 있으며, mysql < doc/travel_mate.sql 로 DB 초기화합니다.
    files:
      - path: database/migrations/V1__create_users_table.sql
        description: "`users` 테이블 생성 스크립트"
        type: create
      - path: database/migrations/V2__create_user_profiles_tables.sql
        description: "`user_profiles`, `tags`, `user_profile_tags` 테이블 생성 스크립트"
        type: create
      - path: database/migrations/V3__create_messaging_tables.sql
        description: "`private_messages`, `chat_rooms`, `fcm_tokens` 테이블 생성 스크립트"
        type: create
      - path: database/migrations/V4__create_community_tables.sql
        description: "`post_categories`, `posts`, `itineraries`, `itinerary_days`, `itinerary_activities`, `comments`, `likes`,
          `bookmarks`, `reports` 테이블 생성 스크립트"
        type: create
    subtasks:
      - id: db-002-users-table
        title: "`users` 테이블 스키마 정의 및 마이그레이션"
        description: 사용자의 기본 정보를 저장하는 `users` 테이블을 생성합니다. Primary Key는 랜덤 영숫자 `id`(VARCHAR(32))이며, `firebase_uid`는 UNIQUE. 이메일 컬럼은 없습니다.
        category: data
        implementation_notes:
          - TRD의 `users` 스키마를 따릅니다. PK=id(랜덤 영숫자), 모든 사용자 FK(userId, authorId 등)는 users.id를 참조합니다.
          - "`firebase_uid`에 UNIQUE 인덱스를 추가하여 데이터 무결성을 보장합니다."
          - 생성 및 업데이트 타임스탬프 필드를 포함합니다.
      - id: db-002-profiles-tables
        title: "`user_profiles`, `tags`, `user_profile_tags` 테이블 스키마 정의 및 마이그레이션"
        description: 사용자의 상세 프로필 정보를 위한 `user_profiles`, 태그 정의를 위한 `tags`, 사용자 프로필과 태그의 다대다 관계를 위한 `user_profile_tags` 테이블을 생성합니다.
        category: data
        implementation_notes:
          - TRD의 `user_profiles`, `tags`, `user_profile_tags` 스키마를 따릅니다.
          - "`user_profiles.userId`는 `users.id`를 참조하는 외래 키로, `ON DELETE CASCADE`를 설정합니다."
          - "`user_profile_tags`는 `user_id`와 `tag_id`의 복합 기본 키를 가집니다."
      - id: db-002-messaging-tables
        title: "`private_messages`, `chat_rooms`, `fcm_tokens` 테이블 스키마 정의 및 마이그레이션"
        description: 비공개 쪽지, 채팅방 메타데이터, FCM 토큰 저장을 위한 테이블을 생성합니다. 적절한 외래 키 제약 조건과 인덱스를 추가합니다.
        category: data
        implementation_notes:
          - TRD의 `private_messages`, `chat_rooms`, `fcm_tokens` 스키마를 따릅니다.
          - 메시징 관련 테이블의 사용자 FK는 `users.id`를 참조하며 `ON DELETE CASCADE`를 설정합니다.
          - "`chat_rooms` 테이블에 `user1Id`, `user2Id`(users.id FK) 및 `createdByUserId`(채팅 신청자 사용자 ID)를 두고, `uq_chat_users (user1Id, user2Id)` 제약으로 중복 채팅방 생성을 방지합니다."
          - "`fcm_tokens` 테이블에 `(user_id, token)` 복합 UNIQUE 인덱스를 추가합니다."
      - id: db-002-community-tables
        title: "`posts`, `itineraries`, `comments`, `likes`, `bookmarks`, `reports` 테이블 스키마 정의 및 마이그레이션"
        description: 커뮤니티 게시글, 여행 일정, 댓글, 좋아요, 북마크, 신고 기능을 위한 모든 테이블 스키마를 정의하고 마이그레이션합니다. JSON 타입을 활용하는 필드(`image_urls`,
          `map_data`)를 포함합니다.
        category: data
        implementation_notes:
          - TRD의 `post_categories`, `posts`, `itineraries`, `itinerary_days`, `itinerary_activities`, `comments`,
            `likes`, `bookmarks`, `reports` 스키마를 따릅니다.
          - 외래 키 제약 조건 `ON DELETE CASCADE`를 적절히 설정하여 사용자 탈퇴 시 관련 데이터가 올바르게 처리되도록 합니다.
          - "`comments` 테이블에 `CHECK (post_id IS NOT NULL OR itinerary_id IS NOT NULL)` 제약 조건을 추가합니다."
          - "`likes`와 `bookmarks` 테이블에 `UNIQUE (user_id, post_id)` 및 `UNIQUE (user_id, itinerary_id)` 제약 조건을 설정합니다."
          - "`reports` 테이블에 중복 신고 방지를 위한 `UNIQUE (reporter_user_id, reported_post_id, reported_itinerary_id,
            reported_comment_id, reported_user_id)` 제약 조건을 추가합니다."
      - id: db-002-indexing
        title: MariaDB 인덱스 최적화
        description: TRD NFR1.1에 따라 `user_profiles`, `user_profile_tags`, `tags` 테이블에 적절한 인덱스를 생성하여 검색 및 필터링 성능을 최적화합니다. 또한, 모든
          외래 키에도 인덱스를 생성합니다.
        category: performance
        implementation_notes:
          - MariaDB에서 `EXPLAIN` 쿼리를 사용하여 쿼리 플랜을 분석하고, 성능 병목 지점에 대한 인덱스를 식별합니다.
          - 특히 `user_profiles`의 `destination`, `age_range` 및 `user_profile_tags`의 `tag_id`에 대한 인덱스를 고려합니다.
          - 모든 외래 키에는 기본적으로 인덱스가 필요하며, `post_id`, `itinerary_id`, `user_id` 등 자주 조회 조건으로 사용되는 컬럼에 인덱스를 추가합니다.
    dependencies:
      - setup-001-environment
    completion_criteria:
      - 모든 TRD에 정의된 MariaDB 테이블이 성공적으로 생성됩니다.
      - 각 테이블에 필요한 기본 키, 외래 키, UNIQUE 제약 조건 및 CHECK 제약 조건이 올바르게 적용됩니다.
      - 인덱스 최적화 스크립트가 성공적으로 실행되고 쿼리 성능이 개선됨을 확인합니다.
    risks:
      - risk: 스키마 정의 오류 또는 누락으로 인한 데이터 무결성 문제
        mitigation: 철저한 스키마 리뷰 및 테스트 데이터 삽입을 통한 제약 조건 검증
      - risk: 복잡한 인덱스로 인한 쓰기 성능 저하
        mitigation: 쿼리 패턴 분석을 통한 최소한의 효율적인 인덱스 설계 및 `EXPLAIN`으로 검증
    order: 20
  - id: auth-003-user-authentication
    title: 사용자 인증 기능 구현
    priority: P0
    description: Google 로그인만 지원하는 사용자 회원가입 및 로그인 기능을 구현하고, Firebase Authentication과 Node.js API 서버, MariaDB 간의 연동을 완성합니다. 이메일은 수집·저장하지 않습니다.
    files:
      - path: travel_mate_app/lib/presentation/auth/login_screen.dart
        description: 로그인 UI 컴포넌트
        type: create
      - path: travel_mate_app/lib/presentation/auth/signup_screen.dart
        description: 회원가입 UI 컴포넌트
        type: create
      - path: travel_mate_app/lib/data/datasources/auth_remote_datasource.dart
        description: Firebase Auth 및 API 서버 호출 로직 구현
        type: create
      - path: travel_mate_app/lib/domain/usecases/auth_usecase.dart
        description: 인증 관련 유스케이스 정의
        type: create
      - path: travel_mate_app/lib/presentation/auth/auth_viewmodel.dart
        description: 인증 상태 관리 ViewModel (Provider/Riverpod)
        type: create
      - path: travel_mate_backend/src/models/user.js
        description: MariaDB `users` 테이블 ORM 모델 정의
        type: create
      - path: travel_mate_backend/src/controllers/authController.js
        description: 인증 API 핸들러 로직 구현
        type: create
      - path: travel_mate_backend/src/routes/authRoutes.js
        description: 인증 관련 API 라우팅 정의
        type: create
      - path: travel_mate_backend/src/middlewares/authMiddleware.js
        description: Firebase ID Token 검증 미들웨어 구현
        type: create
      - path: travel_mate_backend/src/app.js
        description: 인증 미들웨어 등록 및 라우터 연결
        type: modify
    subtasks:
      - id: auth-003-flutter-ui
        title: Flutter 인증 UI 개발
        description: 로그인 및 회원가입 화면을 개발하고, Google 로그인 버튼만 구현합니다. (이메일/비밀번호 미지원)
        category: ui
        implementation_notes:
          - UI/UX 가이드라인을 준수하여 직관적인 로그인/회원가입 UI를 설계합니다.
          - Google 로그인 성공 시 idToken을 획득하고 GET /api/auth/me로 백엔드 사용자 ID를 조회합니다.
          - 로그인 및 회원가입 시 로딩 인디케이터를 표시하여 사용자 경험을 향상시킵니다.
      - id: auth-003-flutter-firebase-auth
        title: Flutter Firebase Authentication 연동
        description: Flutter 앱에서 Firebase Authentication `signInWithEmailAndPassword`, `createUserWithEmailAndPassword`,
          `google_sign_in` 패키지 등을 사용하여 사용자 인증을 처리합니다. 로그인 성공 시 Firebase `idToken`을 획득하고 로컬 저장소에 저장합니다.
        category: core
        implementation_notes:
          - Firebase Auth 인스턴스를 초기화하고, Google 로그인만 구현합니다.
          - 로그인 성공 시 반환되는 `UserCredential`에서 `idToken`을 추출하고 `shared_preferences`에 안전하게 저장합니다.
          - 인증 상태를 Provider/Riverpod를 통해 관리하여 앱 전반에 걸쳐 접근할 수 있도록 합니다.
      - id: auth-003-backend-token-verification
        title: Node.js API 서버 Firebase ID Token 검증 미들웨어 구현
        description: 클라이언트로부터 받은 Firebase `idToken`을 `firebase-admin` SDK의 `verifyIdToken` 메서드를 사용하여 검증하는 미들웨어를 구현합니다. 유효한 토큰일
          경우 `req.user`에 `decodedToken`을 추가하고 다음 미들웨어로 넘깁니다.
        category: api
        implementation_notes:
          - Firebase Admin SDK를 `app.js` 또는 `config` 파일에서 초기화합니다.
          - 미들웨어는 모든 보호된 API 경로에 적용되어야 하며, 토큰이 없거나 유효하지 않은 경우 401 응답을 반환합니다.
          - 토큰 검증 시 네트워크 지연을 최소화하도록 캐싱 전략을 고려할 수 있습니다 (NFR1.1, NFR2.2 참조).
      - id: auth-003-backend-register-login-api
        title: Node.js API 서버 회원가입 및 로그인 API 구현
        description: "`POST /api/auth/register`와 `POST /api/auth/login` 엔드포인트를 구현합니다. `idToken`을 검증한 후 MariaDB `users` 테이블에 사용자
          정보를 등록하거나 유효성을 검증합니다."
        category: api
        implementation_notes:
          - Sequelize 또는 TypeORM을 사용하여 `users` 테이블과의 상호작용을 추상화합니다.
          - 로그인/회원가입 시, `firebase_uid`로 사용자 조회 또는 랜덤 영숫자 `id`로 새 사용자 생성. 이메일은 저장하지 않습니다.
          - 로그인 시, `firebase_uid`를 사용하여 MariaDB에서 사용자 존재 여부를 확인하고 필요시 업데이트합니다.
          - 모든 응답은 JSON 형식으로 표준화된 형태를 유지합니다.
    dependencies:
      - setup-001-environment
      - db-002-base-schema
    completion_criteria:
      - Google 로그인으로 회원가입 및 로그인이 성공적으로 완료되어야 합니다.
      - Google 소셜 로그인이 성공적으로 완료되어야 합니다.
      - 로그인 성공 후 Flutter 앱에서 `idToken`이 안전하게 로컬에 저장되어야 합니다.
      - Node.js API 서버가 클라이언트로부터 받은 `idToken`을 성공적으로 검증하고 401 Unauthorized 응답을 올바르게 반환합니다.
      - MariaDB `users` 테이블에 신규 사용자 정보가 성공적으로 등록되고, 기존 사용자 정보가 확인되어야 합니다.
    risks:
      - risk: ID Token 위변조 및 무단 접근 시도
        mitigation: Firebase Admin SDK를 통한 서버 측의 철저한 ID Token 검증 및 권한 미들웨어 적용 (NFR2.2)
      - risk: 민감 정보(ID Token) 로컬 저장 시 보안 취약점 발생
        mitigation: "`shared_preferences` 등 안전한 로컬 저장소 사용 및 필요시 암호화 고려"
    order: 30
  - id: profile-004-detailed-management
    title: 심층 프로필 관리 기능 구현
    priority: P0
    description: 사용자가 여행 스타일, 관심사, 자기소개, 프로필 사진 등을 포함한 상세 프로필 정보를 설정하고 편집할 수 있는 기능을 구현합니다. 백엔드 이미지 업로드 API와 Node.js API 서버,
      MariaDB 간의 연동을 포함합니다.
    files:
      - path: travel_mate_app/lib/presentation/profile/profile_edit_screen.dart
        description: 프로필 편집 UI 컴포넌트
        type: create
      - path: travel_mate_app/lib/presentation/profile/profile_detail_screen.dart
        description: 프로필 상세 조회 UI 컴포넌트
        type: create
      - path: travel_mate_app/lib/data/datasources/profile_remote_datasource.dart
        description: 프로필 API 호출 및 백엔드 이미지 업로드 연동 로직
        type: create
      - path: travel_mate_app/lib/data/repositories/profile_repository_impl.dart
        description: 프로필 데이터 처리 로직 구현체
        type: create
      - path: travel_mate_app/lib/domain/entities/user_profile.dart
        description: 프로필 엔티티 정의
        type: create
      - path: travel_mate_backend/src/models/userProfile.js
        description: MariaDB `user_profiles` 테이블 ORM 모델 정의
        type: create
      - path: travel_mate_backend/src/controllers/userProfileController.js
        description: 프로필 관련 API 핸들러 로직 구현
        type: create
      - path: travel_mate_backend/src/routes/userRoutes.js
        description: 사용자 및 프로필 관련 API 라우팅 정의
        type: create
      - path: travel_mate_backend/src/controllers/uploadController.js
        description: 이미지 업로드 API (POST /api/upload/profile 등)
        type: create
    subtasks:
      - id: profile-004-flutter-ui
        title: Flutter 프로필 편집 및 조회 UI 개발
        description: 사용자가 닉네임, 자기소개, 성별, 연령대, 여행 스타일, 관심사를 입력/선택할 수 있는 `ProfileEditScreen`과 이를 보여주는 `ProfileDetailScreen`을
          개발합니다. `image_picker`를 통합하여 프로필 사진 선택 기능을 구현합니다.
        category: ui
        implementation_notes:
          - 다양한 입력 필드(텍스트, 선택형 태그)에 대한 UI 컴포넌트를 재사용 가능하게 개발합니다.
          - "`image_picker`를 사용하여 갤러리/카메라에서 이미지를 선택하고 미리보기 기능을 제공합니다."
          - 선택형 태그(여행 스타일, 관심사)는 동적으로 관리될 수 있도록 구현합니다.
      - id: profile-004-flutter-backend-upload
        title: Flutter 백엔드 프로필 이미지 업로드
        description: "`image_picker`로 선택된 이미지를 백엔드 POST /api/upload/profile 로 업로드하고, 반환되는 imageUrl을 획득합니다. 이미지 업로드 전 클라이언트에서 압축하여 전송 시간을
          단축합니다."
        category: data
        implementation_notes:
          - Dio 등으로 multipart/form-data (필드명 image) 요청을 POST /api/upload/profile 에 보냅니다.
          - 업로드 전 `flutter_image_compress` 등으로 이미지 크기를 최적화합니다 (NFR1.3).
      - id: profile-004-backend-profile-crud
        title: Node.js API 서버 프로필 CRUD API 구현
        description: "`GET /api/users/{userId}/profile`, `PATCH /api/users/{userId}/profile`, `POST
          /api/users/{userId}/profile/image` 엔드포인트를 구현합니다. `user_profiles` 및 `user_profile_tags` 테이블과 상호작용하며, MariaDB에
          프로필 정보와 이미지 URL을 저장합니다. 권한 미들웨어를 통해 본인만 수정 가능하도록 합니다."
        category: api
        implementation_notes:
          - Sequelize/TypeORM을 사용하여 `user_profiles`, `tags`, `user_profile_tags` 테이블과의 상호작용을 구현합니다.
          - "`PATCH` 요청 시 부분 업데이트를 지원하도록 합니다."
          - "`POST /api/users/{userId}/profile/image`는 클라이언트가 먼저 POST /api/upload/profile 로 업로드한 뒤 받은 URL을 받아 MariaDB에 저장합니다."
          - 사용자 ID를 기반으로 하는 권한 미들웨어(`authMiddleware`)를 적용하여 본인 프로필만 수정 가능하도록 합니다.
      - id: profile-004-backend-upload-auth
        title: 백엔드 이미지 업로드 API 인증
        description: POST /api/upload/profile 등 이미지 업로드 API에 authMiddleware를 적용하여 인증된 사용자만 업로드할 수 있도록 합니다.
        category: security
        implementation_notes:
          - multer와 authMiddleware를 조합하여 인증 후 업로드 디렉터리(uploads/profile/{uid}/)에 저장합니다.
          - 업로드된 파일은 /uploads 정적 경로로 제공되며, 필요 시 읽기 권한 정책을 적용합니다.
    dependencies:
      - auth-003-user-authentication
      - db-002-base-schema
    completion_criteria:
      - 모든 프로필 필드가 Flutter UI에서 정확히 입력/선택되고 저장될 수 있습니다.
      - 갤러리/카메라에서 선택된 프로필 사진이 백엔드에 성공적으로 업로드되고, 반환된 URL이 MariaDB에 저장됩니다.
      - 프로필 수정 시, 변경 사항이 즉시 Flutter UI 및 API 서버/MariaDB에 반영됩니다.
      - 다른 사용자의 프로필은 조회만 가능하며, 수정 시도 시 403 Forbidden 또는 401 Unauthorized 응답이 반환됩니다.
      - 업로드된 이미지가 백엔드 /uploads 경로로 올바르게 제공됩니다.
    risks:
      - risk: 개인 정보 유출 위험 (프로필 사진, 상세 정보)
        mitigation: 백엔드 업로드 API 권한 미들웨어 및 API 서버 인가 검증 강화 (NFR2.2, NFR2.3)
      - risk: 이미지 업로드/로딩 성능 저하
        mitigation: 클라이언트 측 이미지 압축, 백엔드 정적 제공·캐싱, `cached_network_image` 사용 (NFR1.3)
    order: 40
  - id: auth-005-account-management
    title: 개인정보 수정 및 계정 탈퇴 기능 구현
    priority: P1
    description: 사용자가 자신의 개인 정보를 수정하고, 회원 탈퇴를 요청할 수 있는 기능을 구현합니다. Firebase Authentication과 Node.js API 서버, MariaDB 연동을 통해
      데이터 일관성을 유지합니다.
    files:
      - path: travel_mate_app/lib/presentation/settings/account_settings_screen.dart
        description: 계정 설정 및 탈퇴 UI 컴포넌트
        type: create
      - path: travel_mate_app/lib/data/datasources/auth_remote_datasource.dart
        description: 계정 탈퇴 API 호출 로직 추가
        type: modify
      - path: travel_mate_backend/src/controllers/userController.js
        description: 사용자 계정 탈퇴 API 핸들러 로직 구현
        type: create
      - path: travel_mate_backend/src/routes/userRoutes.js
        description: 사용자 계정 탈퇴 API 라우팅 정의
        type: modify
    subtasks:
      - id: auth-005-flutter-ui
        title: Flutter 계정 설정 및 탈퇴 UI 개발
        description: "`AccountSettingsScreen`에 로그아웃 및 회원 탈퇴 버튼을 구현합니다. (이메일 미수집이므로 이메일 변경 UI 없음) 탈퇴 시 사용자에게 명확한 경고 메시지와 최종 확인 절차를 제공합니다."
        category: ui
        implementation_notes:
          - 프로필 수정은 별도 프로필 편집 화면에서 닉네임·소개 등만 수정합니다.
          - 회원 탈퇴 버튼 클릭 시 `AlertDialog`를 통해 사용자에게 최종 확인을 받습니다.
      - id: auth-005-backend-delete-user
        title: Node.js API 서버 사용자 계정 탈퇴 API 구현
        description: "`DELETE /api/users/{userId}` 엔드포인트를 구현합니다. 요청 시 Firebase Admin SDK를 사용하여 Firebase Authentication에서 사용자 계정을
          삭제하고, MariaDB `users` 및 `user_profiles` 등 관련 테이블의 모든 사용자 데이터를 삭제합니다 (`ON DELETE CASCADE` 활용)."
        category: api
        implementation_notes:
          - Firebase Admin SDK의 `deleteUser(uid)` 메서드를 사용하여 Firebase Auth 계정을 삭제합니다.
          - MariaDB에서 `users` 테이블의 해당 사용자(users.id 기준)를 삭제합니다. 외래 키 `ON DELETE CASCADE` 설정 덕분에 `user_profiles`,
            `private_messages`, `chat_rooms`, `fcm_tokens`, `posts`, `itineraries`, `comments`, `likes`, `bookmarks`,
            `reports` 등 모든 관련 데이터가 자동으로 삭제되어야 합니다.
          - 탈퇴 요청 시 `authMiddleware`를 통해 본인임을 검증합니다.
    dependencies:
      - auth-003-user-authentication
      - profile-004-detailed-management
    completion_criteria:
      - 사용자가 계정 탈퇴 요청 시, Firebase Auth 및 MariaDB에서 해당 사용자 정보가 완전히 삭제됩니다.
      - 탈퇴 후 동일한 계정으로 재로그인을 시도할 경우 실패합니다.
      - 탈퇴된 사용자 관련 모든 데이터(프로필, 게시글, 댓글, 쪽지, 채팅방 메타데이터 등)가 MariaDB에서 성공적으로 삭제됩니다.
    risks:
      - risk: 데이터 삭제 누락으로 인한 개인 정보 잔존 또는 무결성 위반
        mitigation: MariaDB의 `ON DELETE CASCADE` 제약 조건을 철저히 검증하고, 삭제 로직 후 데이터베이스에서 실제로 데이터가 삭제되었는지 확인하는 테스트를 수행합니다.
      - risk: 의도치 않은 계정 탈퇴
        mitigation: 탈퇴 과정에서 여러 단계의 사용자 확인 및 경고 메시지 제공
    order: 50
  - id: match-006-companion-search
    title: 동반자 검색 및 필터링 기능 구현
    priority: P0
    description: 사용자가 여행 목적지, 관심사, 기간 등 다양한 조건으로 다른 사용자를 검색하고 필터링할 수 있는 기능을 구현합니다.
    files:
      - path: travel_mate_app/lib/presentation/matching/companion_search_screen.dart
        description: 동반자 검색 UI 컴포넌트
        type: create
      - path: travel_mate_app/lib/data/datasources/user_remote_datasource.dart
        description: 사용자 검색 API 호출 로직 구현
        type: create
      - path: travel_mate_app/lib/domain/usecases/search_companions_usecase.dart
        description: 동반자 검색 유스케이스 정의
        type: create
      - path: travel_mate_backend/src/controllers/userSearchController.js
        description: 사용자 검색 API 핸들러 로직 구현
        type: create
      - path: travel_mate_backend/src/routes/userRoutes.js
        description: 사용자 검색 API 라우팅 정의
        type: modify
    subtasks:
      - id: match-006-flutter-ui
        title: Flutter 동반자 검색 및 필터링 UI 개발
        description: 여행 목적지, 관심사 태그, 여행 시작/종료일, 성별, 연령대 등을 입력받는 검색 UI를 구현하고, 검색 결과를 카드 형태로 표시하는 화면을 개발합니다. 검색 결과 로딩 시 로딩 스피너를 표시합니다.
        category: ui
        implementation_notes:
          - 다양한 검색 조건을 위한 입력 위젯(텍스트 필드, 드롭다운, 날짜 선택기)을 제공합니다.
          - 검색 결과는 `ListView.builder`를 사용하여 효율적으로 렌더링하고, 무한 스크롤을 고려합니다.
          - NFR1.1에 따라 3초 이내 응답을 위한 로딩 UI를 구현합니다.
      - id: match-006-backend-search-api
        title: Node.js API 서버 동반자 검색 API 구현
        description: "`GET /api/users/search` 엔드포인트를 구현하여 쿼리 파라미터에 따라 `user_profiles` 및 `user_profile_tags` 테이블을 조인하여 사용자를
          검색합니다. 검색 결과는 관련성 및 페이징을 고려하여 반환합니다."
        category: api
        implementation_notes:
          - MariaDB의 `JOIN` 및 `WHERE` 절을 활용하여 효율적인 SQL 쿼리를 작성합니다.
          - "정렬 기준(예: 매칭되는 태그 수, 최근 활동 시간)을 정의하고 구현합니다."
          - 페이징(offset/limit) 기능을 포함하여 대량의 검색 결과에 대응합니다.
          - "쿼리 파라미터에 대한 유효성 검사를 수행합니다 (예: 날짜 형식, 숫자 범위)."
      - id: match-006-db-indexing
        title: MariaDB 검색 성능 최적화를 위한 인덱스 추가
        description: 동반자 검색 API의 성능 향상을 위해 `user_profiles` 테이블의 `destination`, `gender`, `age_range` 및 `user_profile_tags` 테이블의
          `tag_id`에 적절한 인덱스를 추가하거나 복합 인덱스를 고려합니다.
        category: performance
        implementation_notes:
          - NFR1.1에 따라 3초 이내 검색 결과 제공을 목표로 합니다.
          - MariaDB의 `EXPLAIN`을 사용하여 쿼리 성능을 분석하고 최적의 인덱스를 설계합니다.
          - 특히 여러 필터링 조건이 동시에 사용될 경우를 대비한 복합 인덱스를 고려합니다.
    dependencies:
      - profile-004-detailed-management
    completion_criteria:
      - 다양한 필터링 조건(목적지, 관심사 태그, 날짜, 성별, 연령대)에 따라 정확한 검색 결과가 3초 이내에 Flutter UI에 표시되어야 합니다.
      - 검색 결과가 관련성 높은 순으로 정렬되어야 합니다.
      - API 서버에서 유효하지 않은 쿼리 파라미터에 대해 적절한 오류 응답을 반환합니다.
      - MariaDB에서 검색 쿼리가 효율적으로 실행되고 있음을 `EXPLAIN` 등으로 확인합니다.
    risks:
      - risk: 검색 쿼리 성능 저하로 NFR1.1 미달성
        mitigation: MariaDB 인덱스 최적화, 캐싱 전략 고려 (Redis), API 서버 쿼리 최적화
      - risk: 잘못된 검색 로직으로 인한 부정확한 결과
        mitigation: 다양한 시나리오에 대한 단위 및 통합 테스트 강화
    order: 60
  - id: match-007-private-messaging
    title: 프로필 열람 및 비공개 쪽지 발송 기능 구현
    priority: P0
    description: 사용자가 다른 사용자의 상세 프로필을 열람하고, 초기 연락을 위한 비공개 쪽지를 발송할 수 있는 기능을 구현합니다. 쪽지 발송 시 FCM 알림을 연동합니다.
    files:
      - path: travel_mate_app/lib/presentation/profile/user_profile_screen.dart
        description: 다른 사용자 프로필 조회 UI 컴포넌트
        type: create
      - path: travel_mate_app/lib/presentation/chat/new_message_screen.dart
        description: 새 쪽지 작성 UI 컴포넌트
        type: create
      - path: travel_mate_app/lib/data/datasources/message_remote_datasource.dart
        description: 쪽지 발송 API 호출 로직 구현
        type: create
      - path: travel_mate_app/lib/domain/entities/private_message.dart
        description: 비공개 쪽지 엔티티 정의
        type: create
      - path: travel_mate_backend/src/models/privateMessage.js
        description: MariaDB `private_messages` 테이블 ORM 모델 정의
        type: create
      - path: travel_mate_backend/src/controllers/messageController.js
        description: 쪽지 발송 API 핸들러 로직 구현
        type: create
      - path: travel_mate_backend/src/routes/messageRoutes.js
        description: 쪽지 관련 API 라우팅 정의
        type: create
      - path: travel_mate_backend/src/services/notificationService.js
        description: FCM 알림 발송 서비스
        type: create
    subtasks:
      - id: match-007-flutter-profile-view
        title: Flutter 다른 사용자 프로필 열람 UI 개발
        description: "`UserProfileScreen`에서 상대방의 상세 프로필 정보를 표시하고, '쪽지 보내기' 버튼을 포함합니다."
        category: ui
        implementation_notes:
          - 자신의 프로필(`ProfileDetailScreen`)과 유사한 UI 컴포넌트를 재사용하여 개발 시간을 단축합니다.
          - 민감한 정보는 표시하지 않도록 필터링하여 보여줍니다.
      - id: match-007-flutter-private-message-ui
        title: Flutter 비공개 쪽지 작성 및 발송 UI 개발
        description: "`NewMessageScreen`에서 메시지 작성 필드와 전송 버튼을 제공하고, 메시지 전송 성공 시 사용자에게 알림(`showSnackBar`)을 표시합니다."
        category: ui
        implementation_notes:
          - 메시지 내용을 텍스트 필드로 입력받고, 빈 메시지 전송을 방지하는 유효성 검사를 추가합니다.
          - 메시지 전송 후 입력 필드를 초기화하고, 화면 전환 없이 성공 여부를 시각적으로 피드백합니다.
      - id: match-007-backend-private-message-api
        title: Node.js API 서버 비공개 쪽지 발송 API 구현
        description: "`POST /api/messages/private` 엔드포인트를 구현하여 `sender_id`, `receiver_id`, `content`를 받아 MariaDB
          `private_messages` 테이블에 저장합니다. 쪽지 수신자에게 FCM을 통해 알림을 발송합니다."
        category: api
        implementation_notes:
          - MariaDB `private_messages` 테이블에 메시지를 저장하는 로직을 구현합니다.
          - 메시지 저장 후, 수신자의 FCM 토큰을 조회하여 `firebase-admin` SDK를 통해 FCM 푸시 알림을 발송합니다.
          - FCM 발송 실패 시 로깅하고, API 응답에는 영향을 주지 않도록 처리합니다.
      - id: match-007-backend-fcm-integration
        title: Node.js API 서버 FCM 토큰 관리 API 구현
        description: "`POST /api/fcm/token` 엔드포인트를 구현하여 클라이언트의 FCM 토큰을 MariaDB `fcm_tokens` 테이블에 등록 및 갱신합니다. 사용자 ID와 FCM 토큰의
          고유성을 보장합니다."
        category: api
        implementation_notes:
          - 클라이언트로부터 `user_id`와 `token`, `device_type`을 받아 `fcm_tokens` 테이블에 저장합니다.
          - 이미 존재하는 `(user_id, token)` 조합은 업데이트하고, 새로운 토큰은 삽입합니다.
          - 하나의 사용자가 여러 기기에서 로그인할 수 있도록 `UNIQUE (user_id, token)` 제약 조건을 활용합니다.
      - id: match-007-flutter-fcm-init
        title: Flutter FCM 토큰 획득 및 서버 전송
        description: Flutter 앱 실행 시 `firebase_messaging` 패키지를 사용하여 FCM 토큰을 획득하고, API 서버의 `/api/fcm/token` 엔드포인트로 전송하여 사용자 정보와 매핑합니다.
        category: setup
        implementation_notes:
          - "`firebase_messaging`을 초기화하고 `getToken()`을 호출하여 토큰을 얻습니다."
          - 획득한 토큰과 현재 로그인된 사용자의 ID를 API 서버로 전송합니다.
          - 토큰 갱신 시(refresh)에도 서버로 전송하는 로직을 구현합니다.
    dependencies:
      - match-006-companion-search
    completion_criteria:
      - 다른 사용자의 프로필이 Flutter 앱에서 정상적으로 로드 및 표시됩니다.
      - 비공개 쪽지 발송 시, MariaDB `private_messages` 테이블에 메시지가 성공적으로 저장됩니다.
      - 쪽지 수신자에게 FCM 푸시 알림이 정상적으로 전송됩니다.
      - FCM 토큰이 앱 실행 시 성공적으로 서버에 등록/갱신됩니다.
    risks:
      - risk: FCM 알림 전송 실패 또는 지연
        mitigation: Firebase Cloud Messaging 진단 도구 활용 및 백엔드 로깅 강화. FCM 토큰 관리 로직(갱신, 만료 처리) 견고화.
      - risk: 쪽지 내용의 보안 취약점
        mitigation: HTTPS를 통한 안전한 전송 및 데이터베이스 접근 제어 강화 (NFR2.1, NFR2.3)
    order: 70
  - id: match-008-realtime-chat
    title: 1:1 실시간 채팅 기능 구현
    priority: P0
    description: 상대에게 채팅 요청 시 채팅방을 생성·반환하고, 내가 참여한 채팅방(신청한/신청받은) 목록만 표시하여 그 안에서 선택해 대화합니다. 채팅방 찾기 조건(검색/필터)은 제공하지 않습니다. 메시지는 Firebase Firestore로 실시간 전송·수신합니다.
    files:
      - path: travel_mate_app/lib/presentation/chat/chat_list_screen.dart
        description: 채팅방 목록 UI 컴포넌트
        type: create
      - path: travel_mate_app/lib/presentation/chat/chat_room_screen.dart
        description: 1:1 실시간 채팅방 UI 컴포넌트
        type: create
      - path: travel_mate_app/lib/data/datasources/chat_remote_datasource.dart
        description: Firestore 채팅 데이터 연동 로직
        type: create
      - path: travel_mate_app/lib/domain/entities/chat_message.dart
        description: 채팅 메시지 엔티티 정의
        type: create
      - path: travel_mate_backend/src/models/chatRoom.js
        description: MariaDB `chat_rooms` 테이블 ORM 모델 정의
        type: create
      - path: travel_mate_backend/src/controllers/chatController.js
        description: 채팅방 생성 API 핸들러 로직 구현
        type: create
      - path: travel_mate_backend/src/routes/chatRoutes.js
        description: 채팅 관련 API 라우팅 정의
        type: create
      - path: firebase.rules
        description: Firestore 보안 규칙 정의 파일
        type: create
    subtasks:
      - id: match-008-flutter-chat-ui
        title: Flutter 채팅방 목록 및 실시간 채팅 UI 개발
        description: "`ChatListScreen`에서 GET /api/chat/rooms로 내가 참여한 채팅방(신청한/신청받은) 목록만 표시하고, '내가 신청'·'신청받음' 구분을 표시합니다. 채팅방 찾기 조건은 없습니다. `ChatRoomScreen`에서 과거 메시지 로드 및 실시간 메시지 전송/수신 UI를 구현합니다."
        category: ui
        implementation_notes:
          - 채팅 목록은 API 기반이며, 프로필·게시글 상세에서 '채팅하기' 시 채팅 요청(POST /api/chat/room) 후 채팅 목록(/chat)으로 이동합니다.
          - 채팅방 UI는 메시지 버블, 타임스탬프, 스크롤 최적화 등을 고려하여 사용자 친화적으로 구현합니다.
          - 메시지 전송 시 낙관적 UI 업데이트(Optimistic UI Update)를 고려하여 사용자 경험을 향상시킵니다.
      - id: match-008-firestore-integration
        title: Firebase Firestore 실시간 채팅 연동
        description: "`cloud_firestore` 패키지를 사용하여 채팅 메시지를 `chats/{chat_id}/messages` 서브컬렉션에 저장하고, 실시간 리스너를 통해 메시지 변경 사항을 클라이언트에
          즉시 동기화합니다."
        category: core
        implementation_notes:
          - "`chat_id`는 두 사용자 ID를 조합한 고유한 값으로 생성합니다 (예: `user1Id_user2Id` 또는 `chat_rooms.firestore_chat_id`)."
          - 메시지 데이터 모델은 `sender_id`, `receiver_id`, `content`, `timestamp` 등을 포함합니다.
          - Firestore `CollectionReference`의 `snapshots()` 메서드를 사용하여 실시간 스트림을 구독하고 UI를 업데이트합니다.
      - id: match-008-backend-chat-room-api
        title: Node.js API 서버 채팅 요청·채팅방 목록 API 구현
        description: "`POST /api/chat/room`(partnerId=상대 사용자 ID)으로 채팅 요청 시 기존 방이 있으면 반환, 없으면 생성(createdByUserId=현재 사용자). `GET /api/chat/rooms`로 내가 참여한 채팅방 목록(신청한/신청받은 구분)을 반환합니다."
        category: api
        implementation_notes:
          - 클라이언트에서 요청 시, user1Id·user2Id(사용자 id 정렬) 및 createdByUserId(채팅 신청자)를 저장하고, firestoreChatId를 생성합니다.
          - GET /api/chat/rooms는 user1Id 또는 user2Id가 현재 사용자 id인 방만 반환하며, isRequestedByMe(createdByUserId=나) 등 정보를 포함합니다.
          - Firestore chat_id는 firestoreChatId와 동일하게 사용하여 메시지 실시간 동기화에 활용합니다.
      - id: match-008-firestore-security-rules
        title: Firebase Firestore 보안 규칙 설정
        description: Firestore 보안 규칙을 설정하여 각 채팅방에 참여한 사용자만 해당 채팅방의 메시지를 읽고 쓸 수 있도록 엄격하게 권한을 제한합니다. NFR2.3을 준수합니다.
        category: security
        implementation_notes:
          - 규칙은 `match /chats/{chatId}/messages/{messageId}` 경로에 대해 `request.auth.uid`가 `chatId`에 포함된 사용자인지 확인합니다.
          - 보안 규칙을 통해 `sender_id`와 `receiver_id`가 올바른지 검증합니다.
          - 테스트 환경에서 보안 규칙이 올바르게 작동하는지 `Firebase Rules Playground`를 사용하여 검증합니다.
    dependencies:
      - match-007-private-messaging
    completion_criteria:
      - 메시지 전송 후 1초 이내에 상대방 기기에서 메시지가 수신되어 Flutter UI에 표시되어야 합니다.
      - 채팅방 입장 시 과거 메시지 기록이 정상적으로 로드되어야 합니다.
      - 채팅방 목록이 실시간으로 업데이트되어야 합니다.
      - MariaDB `chat_rooms` 테이블과 Firebase Firestore에 채팅방 및 메시지 데이터가 일관성 있게 저장됩니다.
      - Firestore 보안 규칙이 올바르게 적용되어 비인가 접근이 차단됩니다.
    risks:
      - risk: 실시간 메시지 전송 지연 또는 유실 (NFR1.2 미달성)
        mitigation: Firestore의 리스너 및 트랜잭션 최적화, 클라이언트 네트워크 환경 고려.
      - risk: 채팅 데이터에 대한 비인가 접근 (NFR2.3 미달성)
        mitigation: Firestore 보안 규칙을 통한 철저한 권한 제어 및 정기적인 규칙 검토.
    order: 80
  - id: community-009-public-forum
    title: 공개 게시판 참여 기능 구현
    priority: P0
    description: 사용자가 자유롭게 게시글을 작성하고, 열람하며, 카테고리별 검색/필터링이 가능한 공개 커뮤니티 게시판 기능을 구현합니다. 게시글 이미지는 백엔드 POST /api/upload/post 로 업로드합니다.
    files:
      - path: travel_mate_app/lib/presentation/community/community_screen.dart
        description: 커뮤니티 게시글 목록 UI 컴포넌트
        type: create
      - path: travel_mate_app/lib/presentation/community/post_detail_screen.dart
        description: 게시글 상세 조회 UI 컴포넌트
        type: create
      - path: travel_mate_app/lib/presentation/community/post_write_screen.dart
        description: 게시글 작성/수정 UI 컴포넌트
        type: create
      - path: travel_mate_app/lib/data/datasources/post_remote_datasource.dart
        description: 게시글 API 호출 및 백엔드 이미지 업로드 연동 로직
        type: create
      - path: travel_mate_app/lib/domain/entities/post.dart
        description: 게시글 엔티티 정의
        type: create
      - path: travel_mate_backend/src/models/postCategory.js
        description: MariaDB `post_categories` 테이블 ORM 모델 정의
        type: create
      - path: travel_mate_backend/src/models/post.js
        description: MariaDB `posts` 테이블 ORM 모델 정의
        type: create
      - path: travel_mate_backend/src/controllers/postController.js
        description: 게시글 CRUD API 핸들러 로직 구현
        type: create
      - path: travel_mate_backend/src/routes/postRoutes.js
        description: 게시글 관련 API 라우팅 정의
        type: create
    subtasks:
      - id: community-009-flutter-ui
        title: Flutter 게시글 목록, 상세, 작성/수정 UI 개발
        description: "`CommunityScreen`에서 게시글 목록을 표시하고, 카테고리 필터링 및 검색 기능을 구현합니다. `PostDetailScreen`에서 게시글 내용과 이미지를 표시하며, 작성자가 아닐 때 '채팅하기' 버튼으로 작성자에게 채팅 요청을 보낼 수 있습니다. `PostWriteScreen`에서 제목, 내용, 카테고리 입력 및 `image_picker`를 통한 이미지 첨부 기능을 개발합니다."
        category: ui
        implementation_notes:
          - 게시글 목록은 `ListView.builder`로 구현하여 효율적으로 렌더링하고, 무한 스크롤 기능을 포함합니다.
          - 게시글 작성/수정 시 폼 유효성 검사를 수행하고, 이미지 미리보기 기능을 제공합니다.
          - "`cached_network_image`를 사용하여 이미지 로딩 성능을 최적화합니다 (NFR1.3)."
      - id: community-009-flutter-backend-upload
        title: Flutter 게시글 이미지 백엔드 업로드
        description: "`image_picker`로 선택된 이미지를 백엔드 POST /api/upload/post 로 업로드하고, 반환된 imageUrl들을 API 서버에 전송합니다. 이미지 업로드 전 클라이언트에서 압축하여 전송 시간을
          단축합니다."
        category: data
        implementation_notes:
          - 여러 이미지를 순차 또는 병렬로 POST /api/upload/post 에 업로드하고, 각 응답의 imageUrl을 수집합니다.
          - NFR1.3에 따라 이미지 크기를 최적화합니다.
      - id: community-009-backend-crud
        title: Node.js API 서버 게시글 CRUD API 구현
        description: "`GET /api/posts`, `GET /api/posts/{postId}`, `POST /api/posts`, `PUT /api/posts/{postId}`, `DELETE
          /api/posts/{postId}` 엔드포인트를 구현합니다. `posts` 테이블과 상호작용하며, 게시글 카테고리, 이미지 URL(`JSON` 타입)을 관리합니다. 수정/삭제 시 본인 확인을 위한
          권한 검증을 적용합니다."
        category: api
        implementation_notes:
          - Sequelize/TypeORM을 사용하여 `posts` 및 `post_categories` 테이블과의 상호작용을 구현합니다.
          - 게시글 목록 조회 시 카테고리, 검색어, 페이징 필터를 지원합니다.
          - "`image_urls` 필드는 MariaDB의 JSON 타입을 사용하여 여러 이미지 URL을 배열로 저장합니다."
          - 수정 및 삭제 시 `authMiddleware`를 통해 현재 로그인된 사용자가 게시글의 작성자인지 확인하는 인가 로직을 구현합니다 (NFR2.2).
      - id: community-009-backend-upload-auth
        title: 백엔드 게시글 이미지 업로드 API 인증
        description: POST /api/upload/post 에 authMiddleware를 적용하여 인증된 사용자만 업로드할 수 있도록 합니다.
        category: security
        implementation_notes:
          - multer와 authMiddleware로 업로드 디렉터리(uploads/posts/{uid}/)에 저장하고, /uploads 로 정적 제공합니다.
    dependencies:
      - match-008-realtime-chat
    completion_criteria:
      - 새 게시글 작성 후 즉시 커뮤니티 목록에 표시됩니다.
      - 카테고리 필터링 및 검색 기능이 정상 작동하며, 결과가 정확하게 표시됩니다.
      - 게시글 상세 페이지에서 모든 내용(텍스트, 첨부 이미지)이 올바르게 표시됩니다.
      - 게시글 수정/삭제 시 본인만 가능하며, 권한 없는 사용자의 시도는 차단됩니다.
      - 업로드된 게시글 이미지가 백엔드 /uploads 경로로 올바르게 제공됩니다.
    risks:
      - risk: 대량의 게시글 조회 시 성능 저하
        mitigation: MariaDB 인덱스 최적화, 페이징/무한 스크롤 구현, API 서버 캐싱 고려 (NFR1.1, NFR3.1)
      - risk: 악성 이미지 업로드
        mitigation: 백엔드에서 업로드 파일 유효성 검사 및 클라이언트 측 유효성 검사 강화
    order: 90
  - id: community-010-itinerary-sharing
    title: 여행 일정 및 경로 공유 기능 구현
    priority: P0
    description: 사용자가 자신이 다녀온 여행의 상세 일정 및 경로를 작성하고, 사진과 지도를 첨부하여 다른 사용자와 공유할 수 있는 기능을 구현합니다. 이미지는 백엔드 POST /api/upload/itinerary 로
      업로드하고, 지도 데이터도 포함합니다.
    files:
      - path: travel_mate_app/lib/presentation/itinerary/itinerary_list_screen.dart
        description: 여행 일정 목록 UI 컴포넌트
        type: create
      - path: travel_mate_app/lib/presentation/itinerary/itinerary_detail_screen.dart
        description: 여행 일정 상세 조회 UI 컴포넌트
        type: create
      - path: travel_mate_app/lib/presentation/itinerary/itinerary_write_screen.dart
        description: 여행 일정 작성/수정 UI 컴포넌트
        type: create
      - path: travel_mate_app/lib/data/datasources/itinerary_remote_datasource.dart
        description: 여행 일정 API 호출 및 백엔드 이미지 업로드 연동 로직
        type: create
      - path: travel_mate_app/lib/domain/entities/itinerary.dart
        description: 여행 일정 엔티티 정의
        type: create
      - path: travel_mate_backend/src/models/itinerary.js
        description: MariaDB `itineraries` 테이블 ORM 모델 정의
        type: create
      - path: travel_mate_backend/src/models/itineraryDay.js
        description: MariaDB `itinerary_days` 테이블 ORM 모델 정의
        type: create
      - path: travel_mate_backend/src/models/itineraryActivity.js
        description: MariaDB `itinerary_activities` 테이블 ORM 모델 정의
        type: create
      - path: travel_mate_backend/src/controllers/itineraryController.js
        description: 여행 일정 CRUD API 핸들러 로직 구현
        type: create
      - path: travel_mate_backend/src/routes/itineraryRoutes.js
        description: 여행 일정 관련 API 라우팅 정의
        type: create
    subtasks:
      - id: community-010-flutter-ui
        title: Flutter 여행 일정 목록, 상세, 작성/수정 UI 개발
        description: "`ItineraryListScreen`에서 공유된 여행 일정 목록을 표시합니다. `ItineraryWriteScreen`에서 날짜별 활동, 숙소, 교통편 등 상세 일정 및 경로 입력 UI를
          제공하고, `image_picker` 및 `google_maps_flutter`를 통합하여 사진 및 지도 첨부 기능을 구현합니다. `ItineraryDetailScreen`에서 공유된 일정 내용,
          사진, 지도, 댓글을 표시합니다."
        category: ui
        implementation_notes:
          - 복잡한 일정 데이터 입력 UI를 위해 동적으로 아이템을 추가/삭제할 수 있는 폼을 구현합니다.
          - "`google_maps_flutter` 패키지를 사용하여 지도 상에 경로 및 마커를 표시하는 기능을 구현합니다."
          - 이미지 첨부 및 로딩은 게시글과 유사한 방식으로 처리합니다 (NFR1.3).
      - id: community-010-flutter-firebase-storage
        title: Flutter 여행 일정 이미지 백엔드 업로드
        description: 여행 일정에 첨부되는 이미지를 백엔드 POST /api/upload/itinerary 로 업로드하고, 반환된 URL들을 API 서버에 전송합니다. 이미지 업로드 전 클라이언트에서 압축하여 전송 시간을 단축합니다.
        category: data
        implementation_notes:
          - 게시글 이미지 업로드와 동일한 로직을 재사용하거나 확장하여 구현합니다.
          - 업로드 경로는 `itineraries/{itineraryId}/images/{filename}` 형태로 구성합니다.
          - NFR1.3에 따라 이미지 크기를 최적화합니다.
      - id: community-010-backend-crud
        title: Node.js API 서버 여행 일정 CRUD API 구현
        description: "`GET /api/itineraries`, `GET /api/itineraries/{itineraryId}`, `POST /api/itineraries`, `PUT
          /api/itineraries/{itineraryId}`, `DELETE /api/itineraries/{itineraryId}` 엔드포인트를 구현합니다. `itineraries`,
          `itinerary_days`, `itinerary_activities` 테이블과 상호작용하며, 이미지 URL 및 지도 데이터(`JSON` 타입)를 관리합니다. 수정/삭제 시 본인 확인 권한 검증을
          적용합니다."
        category: api
        implementation_notes:
          - Sequelize/TypeORM을 사용하여 복합적인 관계형 데이터(itineraries, days, activities)를 처리하는 로직을 구현합니다.
          - "`image_urls` 및 `map_data` 필드는 MariaDB의 JSON 타입을 사용하여 저장하고, 유효성 검사를 수행합니다."
          - 수정 및 삭제 시 `authMiddleware`를 통해 현재 로그인된 사용자가 일정의 작성자인지 확인하는 인가 로직을 구현합니다 (NFR2.2).
      - id: community-010-backend-upload-auth
        title: 백엔드 일정 이미지 업로드 API 인증
        description: POST /api/upload/itinerary 에 authMiddleware를 적용하여 인증된 사용자만 업로드할 수 있도록 합니다.
        category: security
        implementation_notes:
          - multer와 authMiddleware로 uploads/itineraries/{uid}/ 에 저장하고, /uploads 로 정적 제공합니다.
    dependencies:
      - community-009-public-forum
    completion_criteria:
      - 새 여행 일정 작성 후 목록에 성공적으로 표시됩니다.
      - 일정 상세 페이지에서 모든 정보(날짜별 활동, 사진, 지도 데이터)가 시각적으로 명확하게 표시됩니다.
      - 지도 첨부 시, 경로 정보가 지도상에 정확히 마커 또는 경로로 표시됩니다.
      - 일정 수정/삭제 시 본인만 가능하며, 권한 없는 사용자의 시도는 차단됩니다.
      - 업로드된 일정 이미지가 백엔드 /uploads 경로로 올바르게 제공됩니다.
    risks:
      - risk: 복잡한 일정 데이터 구조로 인한 저장/조회 오류
        mitigation: ORM 릴레이션 설정 및 트랜잭션 처리 견고화, 데이터 유효성 검사 강화
      - risk: 지도 데이터 표시 오류 또는 성능 저하
        mitigation: "`google_maps_flutter` 사용법 숙지 및 최적화, 경량화된 지도 데이터 형식 사용"
    order: 100
  - id: community-011-comments-qa
    title: 댓글 및 질문/답변 기능 구현
    priority: P0
    description: 게시글 및 여행 일정에 댓글을 달거나 질문을 하고, 다른 사용자의 질문에 답변할 수 있는 기능을 구현합니다. 대댓글 기능을 포함하며, 질문/답변 시 원 작성자에게 FCM 알림을 발송합니다.
    files:
      - path: travel_mate_app/lib/presentation/common/comment_section_widget.dart
        description: 댓글 섹션 UI 위젯
        type: create
      - path: travel_mate_app/lib/data/datasources/comment_remote_datasource.dart
        description: 댓글 API 호출 로직 구현
        type: create
      - path: travel_mate_app/lib/domain/entities/comment.dart
        description: 댓글 엔티티 정의
        type: create
      - path: travel_mate_backend/src/models/comment.js
        description: MariaDB `comments` 테이블 ORM 모델 정의
        type: create
      - path: travel_mate_backend/src/controllers/commentController.js
        description: 댓글 CRUD API 핸들러 로직 구현
        type: create
      - path: travel_mate_backend/src/routes/commentRoutes.js
        description: 댓글 관련 API 라우팅 정의
        type: create
    subtasks:
      - id: community-011-flutter-ui
        title: Flutter 댓글 섹션 UI 개발 (대댓글 포함)
        description: 게시글 및 일정 상세 페이지 하단에 댓글 입력 필드와 댓글 목록(`CommentSectionWidget`)을 표시합니다. 대댓글을 시각적으로 구분하여 계층 구조를 명확히 보여주는 UI를 구현합니다.
        category: ui
        implementation_notes:
          - 댓글 목록은 `ListView.builder`를 사용하여 효율적으로 렌더링하고, 대댓글은 들여쓰기 등으로 시각적으로 구분합니다.
          - 댓글 작성 시, 빈 내용 전송을 방지하는 유효성 검사를 추가합니다.
          - 댓글 작성 후 즉시 UI에 반영되도록 최적화합니다.
      - id: community-011-backend-crud
        title: Node.js API 서버 댓글 CRUD API 구현
        description: "`GET /api/posts/{postId}/comments`, `POST /api/posts/{postId}/comments`, `PUT /api/comments/{commentId}`,
          `DELETE /api/comments/{commentId}` 엔드포인트를 구현합니다. `comments` 테이블과 상호작용하며, `parent_comment_id`를 통해 대댓글을 관리합니다.
          질문/답변 시 해당 콘텐츠 작성자에게 FCM 알림을 발송합니다."
        category: api
        implementation_notes:
          - Sequelize/TypeORM을 사용하여 `comments` 테이블과의 상호작용을 구현합니다.
          - 댓글 조회 시 대댓글을 포함한 계층 구조로 반환하는 로직을 구현합니다.
          - 댓글 작성 시 `parent_comment_id`가 있으면 대댓글로 처리합니다.
          - 댓글 작성 또는 대댓글 작성 시, 해당 게시글/일정의 작성자 및 부모 댓글 작성자에게 FCM 알림을 발송합니다 (알림 서비스 재사용).
    dependencies:
      - community-009-public-forum
      - community-010-itinerary-sharing
    completion_criteria:
      - 새 댓글 작성 후 즉시 댓글 목록에 표시됩니다.
      - 대댓글 기능이 정상 작동하며, 계층 구조가 UI에 올바르게 표시됩니다.
      - 댓글 수정/삭제 시 본인만 가능하며, 권한 없는 사용자의 시도는 차단됩니다.
      - 질문/답변 시 해당 콘텐츠 작성자에게 FCM 알림이 정상적으로 발송됩니다.
    risks:
      - risk: 복잡한 대댓글 구조로 인한 UI/API 구현의 어려움
        mitigation: 계층형 데이터 처리에 대한 ORM 및 UI 로직 설계 시 충분한 고민과 테스트
      - risk: 댓글 알림 폭증으로 인한 사용자 피로도 증가
        mitigation: 알림 설정 옵션(앱 내, 백엔드) 및 알림 전송 로직의 최적화
    order: 110
  - id: community-012-likes-bookmarks
    title: 콘텐츠 좋아요/북마크 기능 구현
    priority: P1
    description: 사용자가 게시글 및 여행 일정에 '좋아요'를 누르거나, '북마크'하여 나중에 다시 볼 수 있는 기능을 구현합니다. 사용자의 좋아요/북마크 상태에 따라 UI가 변경되도록 합니다.
    files:
      - path: travel_mate_app/lib/presentation/common/like_button_widget.dart
        description: 좋아요 버튼 UI 위젯
        type: create
      - path: travel_mate_app/lib/presentation/common/bookmark_button_widget.dart
        description: 북마크 버튼 UI 위젯
        type: create
      - path: travel_mate_app/lib/data/datasources/interaction_remote_datasource.dart
        description: 좋아요/북마크 API 호출 로직 구현
        type: create
      - path: travel_mate_backend/src/models/like.js
        description: MariaDB `likes` 테이블 ORM 모델 정의
        type: create
      - path: travel_mate_backend/src/models/bookmark.js
        description: MariaDB `bookmarks` 테이블 ORM 모델 정의
        type: create
      - path: travel_mate_backend/src/controllers/interactionController.js
        description: 좋아요/북마크 API 핸들러 로직 구현
        type: create
      - path: travel_mate_backend/src/routes/interactionRoutes.js
        description: 좋아요/북마크 관련 API 라우팅 정의
        type: create
    subtasks:
      - id: community-012-flutter-ui
        title: Flutter 좋아요/북마크 버튼 UI 개발
        description: 게시글 및 일정 상세/목록 페이지에 좋아요/북마크 버튼을 표시하고, 사용자의 상태에 따라 버튼의 UI(아이콘, 색상 등)가 즉시 토글되도록 구현합니다.
        category: ui
        implementation_notes:
          - 버튼 클릭 시 API 호출을 통해 서버 상태를 업데이트하고, 응답에 따라 로컬 UI 상태를 변경합니다.
          - 버튼 상태 변경 시 애니메이션을 추가하여 사용자 경험을 향상시킵니다.
      - id: community-012-backend-api
        title: Node.js API 서버 좋아요/북마크 API 구현
        description: "`POST /api/posts/{postId}/like`, `POST /api/itineraries/{itineraryId}/like`, `POST
          /api/posts/{postId}/bookmark`, `POST /api/itineraries/{itineraryId}/bookmark` 엔드포인트를 구현합니다. `likes` 및
          `bookmarks` 테이블에 사용자-콘텐츠 관계를 저장/삭제하며, 중복 요청을 방지합니다."
        category: api
        implementation_notes:
          - Sequelize/TypeORM을 사용하여 `likes` 및 `bookmarks` 테이블과의 상호작용을 구현합니다.
          - 좋아요/북마크 요청 시, 이미 존재하면 삭제(취소)하고, 없으면 생성하는 토글 로직을 구현합니다.
          - "`UNIQUE` 제약 조건을 활용하여 한 사용자가 동일 콘텐츠에 대해 한 번만 좋아요/북마크할 수 있도록 합니다."
          - 좋아요/북마크 수 집계 로직을 포함하거나, 별도의 뷰(view) 또는 캐싱 전략을 고려합니다.
    dependencies:
      - community-011-comments-qa
    completion_criteria:
      - 좋아요/북마크 버튼 클릭 시 상태가 즉시 Flutter UI에 반영됩니다.
      - MariaDB `likes` 및 `bookmarks` 테이블에 사용자-콘텐츠 관계가 정확하게 기록/삭제됩니다.
      - 각 콘텐츠의 좋아요/북마크 수가 정확하게 집계됩니다.
      - 내 프로필 페이지 등에서 북마크한 콘텐츠 목록이 정상적으로 조회됩니다.
    risks:
      - risk: 데이터 불일치 (UI와 서버 상태 간)
        mitigation: API 응답을 통한 UI 상태 동기화 및 낙관적 UI 업데이트 시 오류 처리 로직 강화
      - risk: 동시성 문제로 인한 좋아요/북마크 수 오류
        mitigation: 데이터베이스 트랜잭션 및 UNIQUE 제약 조건 활용
    order: 120
  - id: community-013-reporting
    title: 사용자 콘텐츠 신고 기능 구현
    priority: P1
    description: 사용자가 부적절한 게시글, 일정, 댓글 또는 사용자 프로필을 신고할 수 있는 기능을 구현합니다. 신고 내용을 MariaDB에 기록합니다.
    files:
      - path: travel_mate_app/lib/presentation/common/report_button_widget.dart
        description: 신고 버튼 UI 위젯
        type: create
      - path: travel_mate_app/lib/presentation/common/report_submission_screen.dart
        description: 신고 내용 제출 UI 컴포넌트
        type: create
      - path: travel_mate_app/lib/data/datasources/report_remote_datasource.dart
        description: 신고 API 호출 로직 구현
        type: create
      - path: travel_mate_backend/src/models/report.js
        description: MariaDB `reports` 테이블 ORM 모델 정의
        type: create
      - path: travel_mate_backend/src/controllers/reportController.js
        description: 신고 API 핸들러 로직 구현
        type: create
      - path: travel_mate_backend/src/routes/reportRoutes.js
        description: 신고 관련 API 라우팅 정의
        type: create
    subtasks:
      - id: community-013-flutter-ui
        title: Flutter 신고 UI 개발
        description: 콘텐츠/프로필 상세 화면에 '신고하기' 버튼을 제공하고, 클릭 시 신고 유형 선택 및 상세 내용 입력 UI(`ReportSubmissionScreen`)를 표시합니다. 신고 제출 후 성공
          메시지를 사용자에게 보여줍니다.
        category: ui
        implementation_notes:
          - 신고 유형은 드롭다운 또는 라디오 버튼 형태로 제공하여 사용자가 쉽게 선택할 수 있도록 합니다.
          - 상세 사유 입력 필드에 대한 길이 제한 및 빈 값 검사를 수행합니다.
          - 신고 제출 후 `showSnackBar` 또는 `AlertDialog`를 통해 사용자에게 피드백을 제공합니다.
      - id: community-013-backend-api
        title: Node.js API 서버 신고 접수 API 구현
        description: "`POST /api/reports/content` 및 `POST /api/reports/user` 엔드포인트를 구현합니다. 신고 대상(게시글 ID, 일정 ID, 댓글 ID, 사용자 ID 중
          하나), 신고자 ID, 신고 유형, 상세 사유를 받아 MariaDB `reports` 테이블에 저장합니다. 동일 콘텐츠에 대한 중복 신고는 방지합니다."
        category: api
        implementation_notes:
          - MariaDB `reports` 테이블에 신고 내용을 저장하는 로직을 구현합니다.
          - 신고 대상 중 최소 하나는 존재해야 하는 `CHECK` 제약 조건을 활용하고, `UNIQUE` 제약 조건을 통해 중복 신고를 방지합니다.
          - 신고자의 `user_id`를 기록하여 악의적인 신고를 추적할 수 있도록 합니다.
          - 신고 처리 상태(`status`) 기본값을 'pending'으로 설정합니다.
    dependencies:
      - community-012-likes-bookmarks
    completion_criteria:
      - 신고 버튼 클릭 시 신고 유형 선택 및 상세 내용 입력 UI가 정상적으로 표시됩니다.
      - 신고 제출 후 성공 메시지가 표시되고, MariaDB `reports` 테이블에 신고 내용이 정확하게 기록됩니다.
      - 동일 콘텐츠에 대한 중복 신고는 허용되지 않으며, 적절한 오류 메시지가 반환됩니다.
    risks:
      - risk: 허위/악의적 신고 남발
        mitigation: 신고 이력 추적 및 관리자 시스템에서 제재 조치 (본 TRD 범위 외) 로직 설계 시 고려
      - risk: 신고 대상 정보 누락 또는 오기입
        mitigation: 클라이언트 및 서버 측에서 신고 대상 ID 유효성 검사 강화
    order: 130
  - id: nfr-014-optimizations
    title: 비기능적 요구사항(NFR) 최적화 및 테스트
    priority: P2
    description: 성능, 보안, 확장성, 사용성, 호환성 등 TRD에 명시된 비기능적 요구사항을 검토하고, 필요한 최적화 및 테스트를 수행합니다. 특히 NFR1.1, NFR1.2, NFR1.3 성능 목표 달성을
      위한 추가 작업을 진행합니다.
    files:
      - path: travel_mate_backend/src/config/db.js
        description: 데이터베이스 연결 풀 설정 등 최적화
        type: modify
      - path: travel_mate_backend/src/middlewares/errorHandlingMiddleware.js
        description: 통합 에러 처리 미들웨어 구현
        type: create
      - path: travel_mate_app/lib/core/http/http_client.dart
        description: HTTP 클라이언트 (dio) 설정 및 인터셉터 추가
        type: modify
    subtasks:
      - id: nfr-014-performance-tuning
        title: 성능 최적화 (검색, 채팅, 이미지)
        description: NFR1.1, NFR1.2, NFR1.3을 목표로 MariaDB 쿼리 튜닝, 캐싱 전략(Redis 고려), API 서버 응답 시간 최적화, Flutter 이미지 로딩 최적화 작업을 수행합니다.
        category: performance
        implementation_notes:
          - MariaDB `EXPLAIN`으로 모든 주요 쿼리 분석 및 추가 인덱스 필요성 검토.
          - "Node.js API 서버에서 Redis를 도입하여 자주 조회되는 데이터(예: 인기 게시글, 사용자 프로필 요약) 캐싱을 고려합니다."
          - Flutter 앱의 빌드 성능 및 런타임 성능 프로파일링을 통해 병목 현상을 식별하고 개선합니다.
          - 이미지 로딩 시 `cached_network_image`의 고급 설정(placeholder, errorWidget, image_cache)을 활용합니다.
      - id: nfr-014-security-hardening
        title: 보안 강화 (데이터 암호화, 권한 관리)
        description: NFR2.1, NFR2.2, NFR2.3에 따라 모든 API 통신에 HTTPS 적용, Firebase ID Token 검증 로직 강화, MariaDB 데이터 접근 제어, Firestore 보안
          규칙을 최종 점검하고 강화합니다.
        category: security
        implementation_notes:
          - 배포 환경에서 API 서버에 SSL/TLS 인증서를 적용하여 HTTPS 통신을 강제합니다.
          - API 서버의 `authMiddleware`가 모든 보호된 경로에 올바르게 적용되었는지 확인하고, 권한 없는 접근에 대한 로깅 및 알림 시스템을 구축합니다.
          - MariaDB 서버에 대한 네트워크 접근 제어(방화벽)를 설정하고, `users` 테이블에 대한 직접적인 접근 권한을 최소화합니다.
          - Firestore 보안 규칙을 최종 검토하여 의도치 않은 데이터 노출이나 수정이 발생하지 않도록 합니다.
      - id: nfr-014-scalability-review
        title: 확장성 검토 및 아키텍처 개선
        description: NFR3.1, NFR3.2, NFR3.3에 따라 API 서버의 수평 확장성, MariaDB의 데이터 증가 대응 전략, Flutter 앱의 모듈화 수준을 최종 검토하고 개선합니다.
        category: deploy
        implementation_notes:
          - API 서버가 Stateless하게 설계되었는지, 세션 관리가 JWT 또는 Firebase ID Token으로만 이루어지는지 확인합니다.
          - MariaDB Cloud SQL 또는 AWS RDS와 같은 관리형 서비스에서 Read Replica, 자동 스케일링 옵션 등을 검토합니다.
          - Flutter 앱 및 Node.js API 서버의 `Layered Architecture` 또는 `Clean Architecture` 원칙 준수 여부를 검토하고, 의존성 주입을 통한 모듈 간
            결합도를 낮춥니다.
      - id: nfr-014-usability-review
        title: 사용성 및 호환성 최종 점검
        description: NFR4.1, NFR4.2, NFR4.3 및 NFR5.1에 따라 UI/UX의 직관성, 내비게이션 일관성, 오류 메시지의 명확성, iOS/Android 최신 OS 호환성을 최종 점검합니다.
        category: ui
        implementation_notes:
          - 사용자 시나리오 기반의 통합 테스트를 통해 앱 전반의 UI/UX 흐름을 검증합니다.
          - 모든 오류 메시지가 사용자에게 친화적이고 해결 방법을 제시하는지 확인합니다.
          - 다양한 iOS 및 Android 기기(특히 최신 OS 버전)에서 호환성 테스트를 수행합니다.
    dependencies:
      - community-013-reporting
    completion_criteria:
      - NFR1.1 (3초 이내 검색 결과), NFR1.2 (1초 이내 채팅 전송/수신), NFR1.3 (2초 이내 이미지 업로드/로딩) 성능 목표가 달성되었음을 부하 테스트 또는 실제 환경에서 검증합니다.
      - API 서버 통신이 HTTPS로만 이루어지고, Firebase ID Token 검증이 모든 보호된 API에서 정상 작동함을 확인합니다.
      - MariaDB 및 Firestore에 대한 접근 제어가 올바르게 설정되었음을 확인합니다.
      - Flutter 앱의 UI/UX가 직관적이고 오류 메시지가 명확하며, iOS 및 Android 최신 OS에서 정상 작동함을 확인합니다.
    risks:
      - risk: 성능 목표 미달성
        mitigation: 로드 테스트 및 병목 분석을 통해 문제점 식별 및 반복적인 최적화
      - risk: 배포 후 예상치 못한 보안 취약점 발견
        mitigation: 정기적인 보안 감사 및 최신 보안 패치 적용, 웹 방화벽(WAF) 등 추가 보안 솔루션 도입 고려
    order: 140
implementation_guides:
  - id: ig-001-clean-arch
    title: Flutter 클린 아키텍처 적용 가이드
    category: 아키텍처
    content: Flutter 애플리케이션은 클린 아키텍처 원칙에 따라 `data`, `domain`, `presentation` 레이어로 명확히 분리해야 합니다. 각 레이어는 자신의 책임 범위 내에서만
      상호작용하며, 의존성은 안쪽으로 향해야 합니다. 이를 통해 코드의 유지보수성, 테스트 용이성, 확장성을 높입니다.
    related_tasks:
      - setup-001-flutter-init
      - auth-003-flutter-ui
      - profile-004-flutter-ui
      - nfr-014-scalability-review
    code_examples:
      - language: dart
        code: |
          /* lib/domain/repositories/auth_repository.dart */
          abstract class AuthRepository {
            Future<UserCredential> signInWithGoogle();
            // Google 로그인만 지원. 로그인 후 idToken으로 GET /api/auth/me 호출해 백엔드 사용자 ID 획득
          }

          /* lib/data/repositories/auth_repository_impl.dart */
          class AuthRepositoryImpl implements AuthRepository {
            final AuthRemoteDataSource remoteDataSource;

            AuthRepositoryImpl(this.remoteDataSource);

            @override
            Future<UserCredential> signInWithGoogle() {
              return remoteDataSource.signInWithGoogle();
            }
          }
        description: 도메인 레이어의 인터페이스와 데이터 레이어의 구현체 예시 (Google 로그인 전용)
  - id: ig-002-node-layered-arch
    title: Node.js 계층형 아키텍처 가이드
    category: 아키텍처
    content: Node.js API 서버는 `controllers`, `services`, `models`, `middlewares`, `routes` 등으로 역할을 명확히 분리한 계층형 아키텍처를 채택합니다.
      `controllers`는 클라이언트 요청을 처리하고 `services`를 호출하며, `services`는 비즈니스 로직을 담당하고 `models`를 통해 데이터베이스와 상호작용합니다.
      `middlewares`는 인증 및 에러 처리 등을 공통으로 수행합니다.
    related_tasks:
      - setup-001-nodejs-init
      - auth-003-backend-register-login-api
      - profile-004-backend-profile-crud
      - nfr-014-scalability-review
    code_examples:
      - language: javascript
        code: |
          // src/controllers/authController.js
          const authService = require('../services/authService');

          exports.register = async (req, res, next) => {
            try {
              const { idToken } = req.body;
              const user = await authService.registerUser(idToken);
              res.status(201).json(user);
            } catch (error) {
              next(error);
            }
          };

          // src/services/authService.js
          const admin = require('firebase-admin');
          const User = require('../models/user');

          exports.registerUser = async (idToken) => {
            const decodedToken = await admin.auth().verifyIdToken(idToken);
            const { uid } = decodedToken;
            let user = await User.findOne({ where: { firebase_uid: uid } });
            if (!user) {
              const id = generateUserId(); // 랜덤 영숫자 32자
              user = await User.create({ id, firebase_uid: uid });
            }
            return user;
          };
        description: 컨트롤러와 서비스 레이어 간의 역할 분리 예시
  - id: ig-003-firebase-id-token-verification
    title: Firebase ID Token 검증 및 인가
    category: 보안
    content: 클라이언트에서 전송된 Firebase ID Token은 Node.js API 서버에서 `firebase-admin` SDK의 `verifyIdToken` 메서드를 통해 매 요청마다 유효성을 검증해야
      합니다. 검증된 토큰에서 `uid`를 추출하여 요청 사용자를 식별하고, 해당 사용자가 요청한 리소스에 접근하거나 수정할 권한이 있는지 확인하는 인가(Authorization) 미들웨어를 구현하여 보안을
      강화합니다 (NFR2.2).
    related_tasks:
      - auth-003-backend-token-verification
      - profile-004-backend-profile-crud
      - auth-005-backend-delete-user
      - nfr-014-security-hardening
    code_examples:
      - language: javascript
        code: |
          // src/middlewares/authMiddleware.js
          const admin = require('firebase-admin');

          const authMiddleware = async (req, res, next) => {
            try {
              const idToken = req.headers.authorization?.split('Bearer ')[1];
              if (!idToken) {
                return res.status(401).send('Unauthorized: No token provided');
              }
              const decodedToken = await admin.auth().verifyIdToken(idToken);
              req.user = decodedToken;
              next();
            } catch (error) {
              console.error('Error verifying Firebase ID token:', error);
              res.status(401).send('Unauthorized: Invalid token');
            }
          };

          module.exports = authMiddleware;
        description: Express 미들웨어를 사용한 Firebase ID Token 검증 예시
  - id: ig-004-mariadb-indexing-optimization
    title: MariaDB 인덱스 최적화 및 쿼리 튜닝
    category: 성능
    content: MariaDB의 쿼리 성능 향상을 위해 TRD NFR1.1에 명시된 검색 및 필터링 시나리오에 맞춰 적절한 인덱스를 생성해야 합니다. `WHERE`, `JOIN`, `ORDER BY` 절에 자주
      사용되는 컬럼에 인덱스를 적용하며, `EXPLAIN` 명령어를 사용하여 쿼리 실행 계획을 분석하고 최적의 인덱스 전략을 수립해야 합니다. 과도한 인덱스는 쓰기 성능 저하를 초래할 수 있으므로 신중하게
      설계합니다.
    related_tasks:
      - db-002-indexing
      - match-006-db-indexing
      - nfr-014-performance-tuning
    code_examples:
      - language: sql
        code: |
          CREATE INDEX idx_user_profiles_destination ON user_profiles(destination);
          CREATE INDEX idx_user_profiles_gender_age_range ON user_profiles(gender, age_range);
          CREATE INDEX idx_user_profile_tags_tag_id ON user_profile_tags(tag_id);
        description: MariaDB 인덱스 생성 SQL 예시
  - id: ig-005-image-optimization
    title: 이미지 업로드 및 로딩 최적화
    category: 성능
    content: NFR1.3에 따라 이미지 업로드 및 로딩은 2초 이내에 완료되어야 합니다. 이를 위해 클라이언트에서 이미지 업로드 전 해상도 및 크기를 최적화(압축)하고, 백엔드 /uploads 정적 제공(및 필요 시 CDN)을
      활용하여 이미지 로딩 속도를 높입니다. Flutter 앱에서는 `cached_network_image`와 같은 라이브러리를 사용하여 캐싱 처리를 구현합니다.
    related_tasks:
      - profile-004-flutter-backend-upload
      - community-009-flutter-backend-upload
      - community-010-flutter-backend-upload
      - nfr-014-performance-tuning
    code_examples:
      - language: dart
        code: |
          import 'package:image_picker/image_picker.dart';
          import 'package:flutter_image_compress/flutter_image_compress.dart';

          Future<Uint8List?> compressImage(XFile imageFile) async {
            final filePath = imageFile.path;
            final targetPath = '${filePath}_compressed.jpg';
            var result = await FlutterImageCompress.compressAndGetFile(
              filePath,
              targetPath,
              quality: 80,
              minWidth: 1024, 
              minHeight: 1024,
            );
            return result?.readAsBytes();
          }
        description: Flutter에서 이미지 업로드 전 압축하는 예시 (flutter_image_compress 사용)
      - language: dart
        code: |
          import 'package:cached_network_image/cached_network_image.dart';

          CachedNetworkImage(
            imageUrl: 'https://example.com/image.jpg',
            placeholder: (context, url) => CircularProgressIndicator(),
            errorWidget: (context, url, error) => Icon(Icons.error),
            imageBuilder: (context, imageProvider) => Container(
              decoration: BoxDecoration(
                image: DecorationImage(image: imageProvider, fit: BoxFit.cover),
              ),
            ),
          );
        description: Flutter에서 cached_network_image를 사용하여 네트워크 이미지 로딩 및 캐싱 처리 예시
  - id: ig-006-firebase-firestore-security
    title: Firebase Firestore 보안 규칙 설정
    category: 보안
    content: "1:1 실시간 채팅 데이터는 민감하므로, Firebase Firestore 보안 규칙을 통해 해당 채팅방에 참여한 사용자만 메시지를 읽고 쓸 수 있도록 엄격하게 제한해야 합니다 (NFR2.3).
      규칙은 `request.auth.uid`를 사용하여 인증된 사용자 ID를 확인하고, 채팅방 문서의 필드(예: `participants` 배열)와 비교하여 접근 권한을 부여합니다."
    related_tasks:
      - match-008-firestore-security-rules
      - nfr-014-security-hardening
    code_examples:
      - language: firebase-rules
        code: |
          rules_version = '2';
          service cloud.firestore {
            match /databases/{database}/documents {
              match /chats/{chatId} {
                // 채팅방 문서 자체는 참여자만 읽을 수 있도록 (메타데이터)
                allow read: if request.auth.uid in get(/databases/$(database)/documents/chats/$(chatId)).data.participants;
                
                match /messages/{messageId} {
                  // 메시지 컬렉션은 참여자만 읽고 쓸 수 있도록
                  allow read, write: if request.auth.uid in get(/databases/$(database)/documents/chats/$(chatId)).data.participants;
                }
              }
            }
          }
        description: Firebase Firestore 1:1 채팅 보안 규칙 예시
  - id: ig-007-error-handling
    title: 통합 에러 처리 및 사용자 친화적 메시지
    category: 사용성
    content: NFR4.3에 따라 앱 전반에 걸쳐 일관되고 사용자 친화적인 오류 메시지를 제공해야 합니다. Node.js API 서버에서는 전역 에러 처리 미들웨어를 구현하여 예상치 못한 오류를 처리하고 표준화된
      에러 응답을 반환합니다. Flutter 앱에서는 이 응답을 파싱하여 `SnackBar`나 `AlertDialog`를 통해 사용자에게 명확하고 이해하기 쉬운 형태로 오류를 알리고, 가능한 경우 해결 방법을
      제시합니다.
    related_tasks:
      - auth-003-flutter-ui
      - match-006-flutter-ui
      - nfr-014-usability-review
    code_examples:
      - language: javascript
        code: |
          // src/middlewares/errorHandler.js
          const errorHandler = (err, req, res, next) => {
            console.error(err.stack);
            const statusCode = err.statusCode || 500;
            res.status(statusCode).json({
              message: err.message || 'An unexpected error occurred.',
              code: err.errorCode || 'SERVER_ERROR'
            });
          };
          module.exports = errorHandler;
        description: Node.js Express 전역 에러 처리 미들웨어 예시
      - language: dart
        code: |
          import 'package:flutter/material.dart';

          void showAppError(BuildContext context, String message) {
            ScaffoldMessenger.of(context).showSnackBar(
              SnackBar(
                content: Text(message),
                backgroundColor: Colors.red,
                duration: Duration(seconds: 3),
              ),
            );
          }

          // Usage in Flutter widget
          try {
            // API call or other operation
          } on DioError catch (e) {
            showAppError(context, e.response?.data['message'] ?? 'Network error');
          } catch (e) {
            showAppError(context, 'An unexpected error occurred: ${e.toString()}');
          }
        description: Flutter에서 사용자 친화적 오류 메시지 표시 예시
execution_order:
  summary: 트래블 메이트 프로젝트는 초기 환경 설정부터 핵심 기능 구현, 커뮤니티 및 정보 공유 기능 개발, 그리고 최종적인 비기능적 요구사항 최적화 및 테스트까지 총 5단계의 페이즈로 진행됩니다. 각 페이즈는
    이전 페이즈의 완료를 전제로 하며, 작업 간의 의존성을 고려하여 효율적인 개발 흐름을 유지합니다.
  phases:
    - phase_name: "Phase 1: 초기 설정 및 기반 구조 구축"
      task_ids:
        - setup-001-environment
        - db-002-base-schema
      description: 프로젝트의 개발 환경을 구축하고, MariaDB의 모든 테이블 스키마를 초기 마이그레이션을 통해 생성합니다. Firebase 프로젝트 설정 및 SDK 연동을 완료하여 향후 기능 개발의 기반을 마련합니다.
    - phase_name: "Phase 2: 핵심 인증 및 사용자 프로필 관리"
      task_ids:
        - auth-003-user-authentication
        - profile-004-detailed-management
        - auth-005-account-management
      description: 사용자 회원가입, 로그인, 프로필 관리 등 핵심 인증 및 사용자 관리 기능을 구현합니다. Firebase Authentication과 Node.js API 서버, MariaDB 간의 안정적인
        연동을 목표로 합니다.
    - phase_name: "Phase 3: 여행 동반자 매칭 및 실시간 소통"
      task_ids:
        - match-006-companion-search
        - match-007-private-messaging
        - match-008-realtime-chat
      description: 여행 동반자 검색, 비공개 쪽지, 1:1 실시간 채팅 등 사용자들이 서로를 찾아 소통할 수 있는 핵심 기능을 개발합니다. Firebase Firestore 및 FCM 연동을 통해 실시간성과
        알림 기능을 구현합니다.
    - phase_name: "Phase 4: 커뮤니티 및 정보 공유 기능"
      task_ids:
        - community-009-public-forum
        - community-010-itinerary-sharing
        - community-011-comments-qa
        - community-012-likes-bookmarks
        - community-013-reporting
      description: 공개 게시판, 여행 일정 공유, 댓글, 좋아요, 북마크, 신고 등 사용자들이 정보를 공유하고 상호작용할 수 있는 커뮤니티 기능을 구현합니다. 이미지는 백엔드 업로드 API로
        관리합니다.
    - phase_name: "Phase 5: 통합, 최적화 및 최종 검증"
      task_ids:
        - nfr-014-optimizations
      description: 개발된 모든 기능을 통합하고, TRD에 명시된 성능, 보안, 확장성, 사용성, 호환성 등 비기능적 요구사항을 최종적으로 검토하고 최적화합니다. 철저한 테스트를 통해 시스템의 안정성과 품질을 확보합니다.
